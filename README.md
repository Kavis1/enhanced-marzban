<p align="center">
  <a href="https://github.com/Kavis1/enhanced-marzban" target="_blank" rel="noopener noreferrer">
    <picture>
      <source media="(prefers-color-scheme: dark)" srcset="https://github.com/Gozargah/Marzban-docs/raw/master/screenshots/logo-dark.png">
      <img width="160" height="160" src="https://github.com/Gozargah/Marzban-docs/raw/master/screenshots/logo-light.png">
    </picture>
  </a>
</p>

<h1 align="center"/>Enhanced Marzban</h1>

<p align="center">
    üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Marzban —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
</p>

<p align="center">
    <strong>Powered by <a href="https://github.com/XTLS/Xray-core">Xray-core</a> | Based on <a href="https://github.com/Gozargah/Marzban">Original Marzban</a></strong>
</p>

<br/>
<p align="center">
    <a href="https://github.com/Kavis1/enhanced-marzban">
        <img src="https://img.shields.io/github/stars/Kavis1/enhanced-marzban?style=flat-square&logo=github" />
    </a>
    <a href="https://github.com/Kavis1/enhanced-marzban/releases">
        <img src="https://img.shields.io/github/v/release/Kavis1/enhanced-marzban?style=flat-square&logo=github" />
    </a>
    <a href="https://github.com/Kavis1/enhanced-marzban/blob/main/LICENSE">
        <img src="https://img.shields.io/github/license/Kavis1/enhanced-marzban?style=flat-square" />
    </a>
    <a href="https://github.com/Kavis1/enhanced-marzban/issues">
        <img src="https://img.shields.io/github/issues/Kavis1/enhanced-marzban?style=flat-square" />
    </a>
    <a href="https://github.com/Kavis1/enhanced-marzban/pulls">
        <img src="https://img.shields.io/github/issues-pr/Kavis1/enhanced-marzban?style=flat-square" />
    </a>
</p>

<p align="center">
  <a href="https://github.com/Kavis1/enhanced-marzban" target="_blank" rel="noopener noreferrer" >
    <img src="https://github.com/Gozargah/Marzban-docs/raw/master/screenshots/preview.png" alt="Enhanced Marzban screenshots" width="600" height="auto">
  </a>
</p>

## üåü –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ Enhanced Marzban?

Enhanced Marzban - —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Marzban —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.</p>

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#-—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
- [‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#-–±—ã—Å—Ç—Ä–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [üåê API](#-api)
- [ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞](#-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)
- [üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

Enhanced Marzban –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ Marzban –ø–ª—é—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

### üîê –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
- **Google Authenticator** —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è TOTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã** –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- **QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** 2FA –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 2FA

### üõ°Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Fail2ban
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞** –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
- **–ê–Ω–∞–ª–∏–∑ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** (–≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, —á–∞—Å—Ç—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Fail2ban
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏** –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### üîó –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–ú–∞–∫—Å–∏–º—É–º 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ IP-–∞–¥—Ä–µ—Å–∞–º**
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üåê DNS –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ DNS –ø—Ä–∞–≤–∏–ª–∞** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ DNS –ø—Ä–∞–≤–∏–ª–∞**
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcard –¥–æ–º–µ–Ω–æ–≤** (*.example.com)
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –ø—Ä–∞–≤–∏–ª
- **DNS –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üö´ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤** –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (EasyList, EasyPrivacy –∏ –¥—Ä.)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å–ø–∏—Å–∫–æ–≤
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏ —É–∑–ª–∞
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã**
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –¥–æ–º–µ–Ω–æ–≤

### üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞** –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π 2FA
- **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã**
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Enhanced Marzban:

```bash
sudo bash -c "$(curl -sL https://github.com/Kavis1/enhanced-marzban/raw/main/install.sh)" @ install
```

### üìã –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Ubuntu 20.04+** –∏–ª–∏ **Debian 11+**
- **Python 3.8+**
- **2GB RAM** (–º–∏–Ω–∏–º—É–º)
- **10GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞** –Ω–∞ –¥–∏—Å–∫–µ
- **Root –¥–æ—Å—Ç—É–ø** –∫ —Å–µ—Ä–≤–µ—Ä—É

### üîß –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sudo apt update
sudo apt install -y python3-pip python3-venv fail2ban curl wget git nginx

# 2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/Kavis1/enhanced-marzban.git
cd enhanced-marzban

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install -r requirements.txt

# 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
python3 -c "from app.db import engine; from app.db.models_enhanced import Base; Base.metadata.create_all(bind=engine)"

# 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Fail2ban
sudo cp fail2ban/jail.local /etc/fail2ban/
sudo cp fail2ban/filter.d/*.conf /etc/fail2ban/filter.d/
sudo cp fail2ban/action.d/*.conf /etc/fail2ban/action.d/
sudo cp scripts/marzban-fail2ban-action.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/marzban-fail2ban-action.sh

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python3 main.py
```

### üéØ –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. **–°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
```bash
python3 -c "
from app.db import get_db
from app.models.admin import Admin
from app.utils.system import hash_password
db = next(get_db())
admin = Admin(username='admin', hashed_password=hash_password('your_password'), is_sudo=True)
db.add(admin)
db.commit()
print('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω: admin / your_password')
"
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ API —Ç–æ–∫–µ–Ω –¥–ª—è Fail2ban:**
```bash
sudo nano /usr/local/bin/marzban-fail2ban-action.sh
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MARZBAN_API_TOKEN="–≤–∞—à-api-—Ç–æ–∫–µ–Ω"
```

3. **–î–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏:**
   - –í–µ–±-–ø–∞–Ω–µ–ª—å: `https://–≤–∞—à-–¥–æ–º–µ–Ω:8000/dashboard/`
   - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `https://–≤–∞—à-–¥–æ–º–µ–Ω:8000/docs`

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üîê –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
# –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
TWO_FACTOR_AUTH_ENABLED=true
TWO_FACTOR_ISSUER_NAME="Enhanced Marzban"
TWO_FACTOR_BACKUP_CODES_COUNT=10

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Fail2ban
FAIL2BAN_ENABLED=true
FAIL2BAN_LOG_PATH="/var/log/marzban/fail2ban.log"
FAIL2BAN_MAX_VIOLATIONS=3
TORRENT_DETECTION_ENABLED=true
TRAFFIC_ANALYSIS_ENABLED=true

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
CONNECTION_LIMIT_ENABLED=true
DEFAULT_MAX_CONNECTIONS=5
CONNECTION_TRACKING_INTERVAL=30

# DNS –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
DNS_OVERRIDE_ENABLED=true
DNS_OVERRIDE_SERVERS="1.1.1.1,8.8.8.8"
DNS_CACHE_TTL=300

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
ADBLOCK_ENABLED=true
ADBLOCK_UPDATE_INTERVAL=86400
ADBLOCK_DEFAULT_LISTS="easylist,easyprivacy,malware"

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—á–∏—Å—Ç–∫–∞
LOG_CLEANUP_ENABLED=true
LOG_RETENTION_DAYS=30
PERFORMANCE_MONITORING_ENABLED=true
```

### üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2ban

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–Ω–æ–≤–∏—Ç–µ API —Ç–æ–∫–µ–Ω –≤ —Å–∫—Ä–∏–ø—Ç–µ –¥–µ–π—Å—Ç–≤–∏–π:

```bash
sudo nano /usr/local/bin/marzban-fail2ban-action.sh
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MARZBAN_API_TOKEN="–≤–∞—à-admin-api-—Ç–æ–∫–µ–Ω"
```

### üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

Enhanced Marzban –≤–∫–ª—é—á–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```nginx
server {
    listen 443 ssl http2;
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.com;

    # SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ssl_certificate /etc/ssl/certs/marzban.crt;
    ssl_certificate_key /etc/ssl/private/marzban.key;

    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üåê API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

Enhanced Marzban –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π REST API:

#### üîê –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `GET /api/2fa/status` - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å 2FA
- `POST /api/2fa/setup` - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 2FA
- `POST /api/2fa/verify-setup` - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å 2FA
- `POST /api/2fa/disable` - –û—Ç–∫–ª—é—á–∏—Ç—å 2FA
- `GET /api/2fa/backup-codes` - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã

#### üõ°Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Fail2ban
- `GET /api/fail2ban/status` - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
- `GET /api/fail2ban/statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
- `GET /api/fail2ban/violations` - –°–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π
- `POST /api/fail2ban/action` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞–Ω/—Ä–∞–∑–±–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

#### üåê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS
- `GET /api/dns/rules` - –ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ DNS –ø—Ä–∞–≤–∏–ª–∞
- `POST /api/dns/rules` - –°–æ–∑–¥–∞—Ç—å DNS –ø—Ä–∞–≤–∏–ª–æ
- `GET /api/dns/users/{user_id}/rules` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ DNS –ø—Ä–∞–≤–∏–ª–∞
- `POST /api/dns/resolve` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞

#### üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
- `GET /api/adblock/lists` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `POST /api/adblock/lists` - –°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `GET /api/adblock/users/{user_id}/settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/adblock/check-domain` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–æ–º–µ–Ω–∞

#### üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- `GET /api/enhanced/status` - –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `GET /api/enhanced/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `GET /api/enhanced/overview` - –û–±–∑–æ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤

### üìä –í–µ–±-–ø–∞–Ω–µ–ª—å

Enhanced Marzban –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –≤–µ–±-–ø–∞–Ω–µ–ª—å —Å:

- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2FA** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π** –∏ –∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –ø—Ä–∞–≤–∏–ª–∞–º–∏**
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã**


## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### üõ°Ô∏è –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** –ø–æ IP-–∞–¥—Ä–µ—Å–∞–º
- **–ó–∞—â–∏—Ç–∞ –æ—Ç DDoS** —á–µ—Ä–µ–∑ Nginx
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** HTTP

### üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π

Enhanced Marzban –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:

- **–¢–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫** –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
- **–í—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É** –Ω–∞ –ø–æ–ª–æ—Å—É –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏—è
- **–ß–∞—Å—Ç—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** —Å –æ–¥–Ω–æ–≥–æ IP
- **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–æ—Å—ã –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏—è**
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤**
- **–ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫**
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**

### üö® –°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π

- **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö
- **Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram –±–æ—Ç–∞**
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞** –æ–ø–æ–≤–µ—â–µ–Ω–∏–π

## üåê API

Enhanced Marzban –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π REST API –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API –≤ Swagger UI –∏–ª–∏ ReDoc, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `DOCS=True` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å–∞–º `/docs` –∏ `/redoc`.

### üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
curl -X GET "https://–≤–∞—à-–¥–æ–º–µ–Ω/api/enhanced/status" \
     -H "Authorization: Bearer –≤–∞—à-—Ç–æ–∫–µ–Ω"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
curl -X POST "https://–≤–∞—à-–¥–æ–º–µ–Ω/api/enhanced/services/fail2ban_logger/restart" \
     -H "Authorization: Bearer –≤–∞—à-—Ç–æ–∫–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl -X GET "https://–≤–∞—à-–¥–æ–º–µ–Ω/api/enhanced/health" \
     -H "Authorization: Bearer –≤–∞—à-—Ç–æ–∫–µ–Ω"
```

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### üìû –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

- **GitHub Issues:** [–°–æ–∑–¥–∞—Ç—å issue](https://github.com/Kavis1/enhanced-marzban/issues)
- **GitHub Discussions:** [–û–±—Å—É–∂–¥–µ–Ω–∏—è](https://github.com/Kavis1/enhanced-marzban/discussions)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [Wiki](https://github.com/Kavis1/enhanced-marzban/wiki)

### üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
journalctl -u enhanced-marzban -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Fail2ban
tail -f /var/log/marzban/fail2ban.log

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
find /var/log/marzban -name "*.log" -mtime +30 -delete
```

#### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump marzban > backup_$(date +%Y%m%d).sql

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
tar -czf config_backup_$(date +%Y%m%d).tar.gz /opt/marzban/.env /etc/fail2ban/
```

### üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Enhanced Marzban:

```bash
cd /opt/marzban
git pull origin main
pip3 install -r requirements.txt
systemctl restart enhanced-marzban
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Enhanced Marzban —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π [AGPL-3.0](./LICENSE).

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ [Marzban](https://github.com/Gozargah/Marzban) –æ—Ç –∫–æ–º–∞–Ω–¥—ã Gozargah.

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç:** [Marzban](https://github.com/Gozargah/Marzban)
- **Xray-core:** [XTLS/Xray-core](https://github.com/XTLS/Xray-core)
- **Fail2ban:** [fail2ban/fail2ban](https://github.com/fail2ban/fail2ban)
- **EasyList:** [easylist.to](https://easylist.to/) –∑–∞ —Å–ø–∏—Å–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã

---

<p align="center">
  <strong>Enhanced Marzban - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—à–µ–≥–æ VPN</strong>
</p>

<p align="center">
  –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
</p>
