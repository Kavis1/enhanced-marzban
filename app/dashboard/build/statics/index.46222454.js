import{i as on,B as jr,a as Hr,b as Br,j as Kn,d as $,U as gn,z as $r,r as Vr,f as Gr,Q as qr,e as Yr,$ as Zr,c as $t,g as _,h as Qr,C as Vt,k as Gt,u as Pe,l as F,m as t,H as b,n as e,T as a,o as oe,p as v,s as Xr,q as x,t as Oe,J as Jr,v as C,w as er,A as qt,x as Kr,y as eo,M as ce,D as de,E as he,F as ue,G as pe,I as xe,K as at,L as tr,N as to,O as Je,P as ge,R as L,S as P,V as nr,W as ne,X as I,Y as ve,Z as V,_ as qe,a0 as ze,a1 as A,a2 as Et,a3 as _t,a4 as no,a5 as Be,a6 as Ye,a7 as ro,a8 as rr,a9 as or,aa as zt,ab as Pt,ac as oo,ad as ye,ae as Ot,af as Xt,ag as so,ah as sr,ai as ir,aj as ar,ak as Ce,al as io,am as ao,an as lo,ao as co,ap as ho,aq as mn,ar as lr,as as cr,at as le,au as Ln,av as uo,aw as po,ax as go,ay as sn,az as dr,aA as mo,aB as hr,aC as ur,aD as pr,aE as fo,aF as jt,aG as gr,aH as bo,aI as yo,aJ as xo,aK as So,aL as Rt,aM as mr,aN as Ut,aO as D,aP as fn,aQ as _o,aR as nt,aS as rt,aT as an,aU as ot,aV as Co,aW as Re,aX as Ue,aY as Ae,aZ as Le,a_ as Te,a$ as Me,b0 as Tn,b1 as wo,b2 as Ne,b3 as tt,b4 as At,b5 as ko,b6 as Yt,b7 as vo,b8 as lt,b9 as zo,ba as Ke,bb as st,bc as fr,bd as br,be as Io,bf as yr,bg as Qe,bh as Do,bi as xr,bj as Eo,bk as bn,bl as Jt,bm as Mn,bn as Sr,bo as yn,bp as xn,bq as $e,br as Sn,bs as Ve,bt as _r,bu as Ro,bv as Cr,bw as Uo,bx as Ao,by as wr,bz as Lo,bA as To,bB as kr,bC as vr,bD as zr,bE as Q,bF as Mo,bG as Ir,bH as Kt,bI as Fo,bJ as Dr,bK as Wo,bL as No,bM as Po,bN as it,bO as We,bP as ie,bQ as Er,bR as Zt,bS as Oo,bT as Rr,bU as jo,bV as ln,bW as cn,bX as He,bY as be,bZ as dn,b_ as re,b$ as Fn,c0 as Ho,c1 as Bo,c2 as $o,c3 as Vo,c4 as Go,c5 as qo,c6 as Yo,c7 as Zo,c8 as Qo,c9 as Xo,ca as Jo,cb as Ko,cc as es,cd as ts,ce as ns,cf as rs,cg as os,ch as ss}from"./vendor.1f496df9.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();on.use(jr).use(Hr).use(Br).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Kn(["/","statics/locales/{{lng}}.json"])}},function(n,r){$.locale(on.language)});on.on("languageChanged",n=>{$.locale(n)});gn("zh-cn",$r);gn("ru",Vr);gn("fa",Gr);const hn=new qr,Ur=n=>{const r=document.querySelector('meta[name="theme-color"]');r==null||r.setAttribute("content",n=="dark"?"#1A202C":"#3B81F6")},is=Yr({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const Ht=()=>localStorage.getItem("token"),as=n=>{localStorage.setItem("token",n)},ls=()=>{localStorage.removeItem("token")},cs=Zr.create({baseURL:"/api/"}),ds=(n,r={})=>(Ht()&&(r.headers={...(r==null?void 0:r.headers)||{},Authorization:`Bearer ${Ht()}`}),cs(n,r)),M=ds,hs=$t(n=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{n({isLoading:!0}),Promise.all([M("/core").then(({version:r,started:o,logs_websocket:s})=>n({version:r,started:o,logs_websocket:s})),M("/core/config").then(r=>n({config:r}))]).finally(()=>n({isLoading:!1}))},updateConfig:r=>(n({isPostLoading:!0}),M("/core/config",{method:"PUT",body:r}).finally(()=>{n({isPostLoading:!1})})),restartCore:()=>M("/core/restart",{method:"POST"})}));function ae(n,r=2,o=!1){if(!+n)return"0 B";const s=1024,i=r<0?0:r,l=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],c=Math.floor(Math.log(n)/Math.log(s));return o?[parseFloat((n/Math.pow(s,c)).toFixed(i)),l[c]]:`${parseFloat((n/Math.pow(s,c)).toFixed(i))} ${l[c]}`}const It=n=>n!=null?n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0",us=_(Qr,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),ps=_(Vt,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),gs=_(Gt,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),en=({title:n,content:r,icon:o})=>t(oe,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[t(b,{alignItems:"center",columnGap:"4",children:[e(v,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:o}),e(a,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:n})]}),e(v,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:r})]}),un="statistics-query-key",ms=n=>{const{version:r}=E(),{data:o}=Pe({queryKey:un,queryFn:()=>M("/system"),refetchInterval:5e3,onSuccess:({version:i})=>{r!==i&&E.setState({version:i})}}),{t:s}=F();return t(b,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...n,children:[e(en,{title:s("activeUsers"),content:o&&t(b,{alignItems:"flex-end",children:[e(a,{children:It(o.users_active)}),t(a,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",It(o.total_user)]})]}),icon:e(us,{})}),e(en,{title:s("dataUsage"),content:o&&ae(o.incoming_bandwidth+o.outgoing_bandwidth),icon:e(ps,{})}),e(en,{title:s("memoryUsage"),content:o&&t(b,{alignItems:"flex-end",children:[e(a,{children:ae(o.mem_used,1,!0)[0]}),t(a,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:[ae(o.mem_used,1,!0)[1]," /"," ",ae(o.mem_total,1)]})]}),icon:e(gs,{})})]})},Ar="marzban-num-users-per-page",Wn=10,fs=()=>{const n=localStorage.getItem(Ar)||Wn.toString();return parseInt(n)||Wn},bs=n=>localStorage.setItem(Ar,n),ys=n=>{for(const r in n)n[r]||delete n[r];return E.setState({loading:!0}),M("/users",{query:n}).then(r=>(E.setState({users:r}),r)).finally(()=>{E.setState({loading:!1})})},xs=()=>M("/inbounds").then(n=>{E.setState({inbounds:new Map(Object.entries(n))})}).finally(()=>{E.setState({loading:!1})}),E=$t(Xr((n,r)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isShowingNodesUsage:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:fs(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,isEditingEnhanced:!1,refetchUsers:()=>{ys(r().filters)},resetAllUsage:()=>M("/users/reset",{method:"POST"}).then(()=>{r().onResetAllUsage(!1),r().refetchUsers()}),onResetAllUsage:o=>n({isResetingAllUsage:o}),onCreateUser:o=>n({isCreatingNewUser:o}),onEditingUser:o=>{n({editingUser:o})},onDeletingUser:o=>{n({deletingUser:o})},onFilterChange:o=>{n({filters:{...r().filters,...o}}),r().refetchUsers()},setQRCode:o=>{n({QRcodeLinks:o})},deleteUser:o=>(n({editingUser:null}),M(`/user/${o.username}`,{method:"DELETE"}).then(()=>{n({deletingUser:null}),r().refetchUsers(),hn.invalidateQueries(un)})),createUser:o=>M("/user",{method:"POST",body:o}).then(()=>{n({editingUser:null}),r().refetchUsers(),hn.invalidateQueries(un)}),editUser:o=>M(`/user/${o.username}`,{method:"PUT",body:o}).then(()=>{r().onEditingUser(null),r().refetchUsers()}),fetchUserUsage:(o,s)=>{for(const i in s)s[i]||delete s[i];return M(`/user/${o.username}/usage`,{method:"GET",query:s})},onEditingHosts:o=>{n({isEditingHosts:o})},onEditingNodes:o=>{n({isEditingNodes:o})},onShowingNodesUsage:o=>{n({isShowingNodesUsage:o})},onEditingEnhanced:o=>{n({isEditingEnhanced:o})},setSubLink:o=>{n({subscribeUrl:o})},resetDataUsage:o=>M(`/user/${o.username}/reset`,{method:"POST"}).then(()=>{n({resetUsageUser:null}),r().refetchUsers()}),revokeSubscription:o=>M(`/user/${o.username}/revoke_sub`,{method:"POST"}).then(s=>{n({revokeSubscriptionUser:null,editingUser:s}),r().refetchUsers()})}))),we=({children:n,color:r})=>e(v,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${r}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${r}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${r}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${r}.400`}},children:e(a,{color:`${r}.500`,_dark:{color:`${r}.900`},position:"relative",zIndex:"2",children:n})});window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(n,r,o)=>{r.isDark=!0,r.cssClass="ace-nord-dark",n("../lib/dom").importCssString(r.cssText,r.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(n,r,o)=>{r.isDark=!1,r.cssClass="ace-dawn",n("../lib/dom").importCssString(r.cssText,r.cssClass)});const Ss=x.exports.forwardRef(({json:n,onChange:r,mode:o="code"},s)=>{const{colorMode:i}=Oe(),l={mode:o,onChangeText:r,statusBar:!1,mainMenuBar:!1,theme:i==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},c=x.exports.useRef(null),g=x.exports.useRef(null);return x.exports.useEffect(()=>(g.current=new Jr(c.current,l),()=>{g.current&&g.current.destroy()}),[]),x.exports.useEffect(()=>{g.current&&g.current.update(n)},[n]),e(v,{ref:s,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(v,{height:"full",ref:c})})}),Lr=C.object({name:C.string().min(1),address:C.string().min(1),port:C.number().min(1).or(C.string().transform(n=>parseFloat(n))),api_port:C.number().min(1).or(C.string().transform(n=>parseFloat(n))),xray_version:C.string().nullable().optional(),id:C.number().nullable().optional(),status:C.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:C.string().nullable().optional(),add_as_new_host:C.boolean().optional(),usage_coefficient:C.number().or(C.string().transform(n=>parseFloat(n)))}),_s=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1}),Dt="fetch-nodes-query-key",Tr=()=>{const{isEditingNodes:n}=E();return Pe({queryKey:Dt,queryFn:Lt.getState().fetchNodes,refetchInterval:n?3e3:void 0,refetchOnWindowFocus:!1})},Lt=$t((n,r)=>({nodes:[],addNode(o){return M("/node",{method:"POST",body:o})},fetchNodes(){return M("/nodes")},fetchNodesUsage(o){return M("/nodes/usage",{query:o})},updateNode(o){return M(`/node/${o.id}`,{method:"PUT",body:o})},setDeletingNode(o){n({deletingNode:o})},reconnectNode(o){return M(`/node/${o.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var o;return M(`/node/${(o=r().deletingNode)==null?void 0:o.id}`,{method:"DELETE"})}})),Nn=500,Cs=_(er,{baseStyle:{w:5,h:5}}),ws=_(qt,{baseStyle:{w:4,h:4}}),ks=_(Kr,{baseStyle:{w:4,h:4}}),vs=_(eo,{baseStyle:{w:3,h:3}}),zs=n=>({[_t.ReadyState.CONNECTING]:"connecting",[_t.ReadyState.OPEN]:"connected",[_t.ReadyState.CLOSING]:"closed",[_t.ReadyState.CLOSED]:"closed",[_t.ReadyState.UNINSTANTIATED]:"closed"})[n],Is=n=>{try{let r=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(r.protocol==="https:"?"wss://":"ws://")+Kn([r.host+r.pathname,n?`/node/${n}/logs`:"/core/logs"])+"?interval=1&token="+Ht()}catch(r){return console.error("Unable to generate websocket url"),console.error(r),null}};let Ze=[];const Ds=()=>{const{colorMode:n}=Oe(),{data:r}=Tr(),o=!1,[s,i]=x.exports.useState(""),l=(T,K)=>{T!==s&&(T==="host"?(i(""),W([])):(i(T),W([])))},{isEditingCore:c}=E(),{fetchCoreSettings:g,updateConfig:d,isLoading:p,config:y,isPostLoading:S,version:u,restartCore:f}=hs(),w=x.exports.useRef(null),[k,W]=x.exports.useState([]),{t:m}=F(),h=xe(),j=at({defaultValues:{config:y||{}}});x.exports.useEffect(()=>{y&&j.setValue("config",y)},[y]),x.exports.useEffect(()=>{c&&g()},[c]);const B=x.exports.useRef(!0),R=x.exports.useCallback(tr(T=>{var Se,J,De;const K=Math.abs((((Se=w.current)==null?void 0:Se.scrollTop)||0)-(((J=w.current)==null?void 0:J.scrollHeight)||0)+(((De=w.current)==null?void 0:De.offsetHeight)||0))<10;w.current&&K?B.current=!0:B.current=!1,T.length<40&&W(T)},300),[]),{readyState:O}=to(Is(s),{onMessage:T=>{Ze.push(T.data),Ze.length>Nn&&(Ze=Ze.splice(0,Ze.length-Nn)),R([...Ze])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});x.exports.useEffect(()=>{var T;w.current&&B.current&&(w.current.scrollTop=(T=w.current)==null?void 0:T.scrollHeight)},[k]),x.exports.useEffect(()=>()=>{Ze=[]},[]);const q=zs(O.toString()),{mutate:Y,isLoading:Z}=Je(f),se=({config:T})=>{d(T).then(()=>{h({title:m("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(K=>{let Se=m("core.generalErrorMessage");typeof K.response._data.detail=="object"&&(Se=K.response._data.detail[Object.keys(K.response._data.detail)[0]]),typeof K.response._data.detail=="string"&&(Se=K.response._data.detail),h({title:Se,status:"error",isClosable:!0,position:"top",duration:3e3})})},me=x.exports.useRef(null),[U,H]=x.exports.useState(!1),X=()=>{var T;document.fullscreenElement?(document.exitFullscreen(),H(!1)):((T=me.current)==null||T.requestFullscreen(),H(!0))};return t("form",{onSubmit:j.handleSubmit(se),children:[t(ge,{children:[t(L,{children:[t(b,{justifyContent:"space-between",alignItems:"flex-start",children:[t(P,{children:[m("core.configuration")," ",p&&e(nr,{isIndeterminate:!0,size:"15px"})]}),e(b,{gap:0,children:e(ne,{label:"Xray Version",placement:"top",children:e(I,{height:"100%",textTransform:"lowercase",children:u&&`v${u}`})})})]}),t(v,{position:"relative",ref:me,minHeight:"300px",children:[e(ve,{control:j.control,name:"config",render:({field:T})=>e(Ss,{json:y,onChange:T.onChange})}),e(V,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:X,children:U?e(vs,{}):e(ks,{})})]})]}),t(L,{mt:"4",children:[t(b,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[t(b,{children:[(r==null?void 0:r[0])&&t(qe,{size:"sm",style:{width:"auto"},disabled:o,bg:"transparent",_dark:{bg:"transparent"},sx:{option:{backgroundColor:n==="dark"?"#222C3B":"white"}},onChange:T=>l(T.currentTarget.value,T.currentTarget.selectedOptions[0].text),children:[e("option",{value:"host",defaultChecked:!0,children:"Master"},"host"),r&&r.map(T=>e("option",{value:String(T.id),children:m(T.name)},T.address))]}),e(P,{className:"w-au",children:m("core.logs")})]}),e(a,{as:P,children:m(`core.socket.${q}`)})]}),e(v,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:w,children:k.map((T,K)=>e(a,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:T},K))})]})]}),e(ze,{children:t(b,{w:"full",justifyContent:"space-between",children:[e(b,{children:e(v,{children:e(A,{size:"sm",leftIcon:e(ws,{className:Et({"animate-spin":Z})}),onClick:()=>Y(),children:m(Z?"core.restarting":"core.restartCore")})})}),e(b,{children:e(A,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:p||S,isLoading:S,children:m("core.save")})})]})})]})},Es=()=>{const{isEditingCore:n}=E(),r=E.setState.bind(null,{isEditingCore:!1}),{t:o}=F();return t(ce,{isOpen:n,onClose:r,size:"3xl",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",w:"full",children:[e(ue,{pt:6,children:t(b,{gap:2,children:[e(we,{color:"primary",children:e(Cs,{color:"white"})}),e(a,{fontWeight:"semibold",fontSize:"lg",children:o("core.title")})]})}),e(pe,{mt:3}),e(Ds,{})]})]})},Tt=_(no,{baseStyle:{w:5,h:5}}),Rs=()=>{const[n,r]=x.exports.useState(!1),{deletingUser:o,onDeletingUser:s,deleteUser:i}=E(),{t:l}=F(),c=xe(),g=()=>{s(null)},d=()=>{o&&(r(!0),i(o).then(()=>{c({title:l("deleteUser.deleteSuccess",{username:o.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(g).finally(r.bind(null,!1)))};return t(ce,{isCentered:!0,isOpen:!!o,onClose:g,size:"sm",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",children:[e(ue,{pt:6,children:e(we,{color:"red",children:e(Tt,{})})}),e(pe,{mt:3}),t(ge,{children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:l("deleteUser.title")}),o&&e(a,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Be,{components:{b:e("b",{})},children:l("deleteUser.prompt",{username:o.username})})})]}),t(ze,{display:"flex",children:[e(A,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(A,{size:"sm",w:"full",colorScheme:"red",onClick:d,leftIcon:n?e(Ye,{size:"xs"}):void 0,children:l("delete")})]})]})]})},_n={baseStyle:{w:4,h:4}},Us=_(ro,_n),As=_(rr,_n),Cn=_(qt,_n),Ls=tr(n=>{E.getState().onFilterChange({...E.getState().filters,offset:0,search:n})},300),Ts=({...n})=>{const{loading:r,filters:o,onFilterChange:s,refetchUsers:i,onCreateUser:l}=E(),{t:c}=F(),[g,d]=x.exports.useState(""),p=S=>{d(S.target.value),Ls(S.target.value)},y=()=>{d(""),s({...o,offset:0,search:""})};return t(or,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...n,children:[e(zt,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:t(Pt,{children:[e(oo,{pointerEvents:"none",children:e(Us,{})}),e(ye,{placeholder:c("search"),value:g,borderColor:"light-border",onChange:p}),t(Ot,{children:[r&&e(Ye,{size:"xs"}),o.search&&o.search.length>0&&e(V,{onClick:y,"aria-label":"clear",size:"xs",variant:"ghost",children:e(As,{})})]})]})}),e(zt,{colSpan:2,order:{base:1,md:2},children:t(b,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(V,{"aria-label":"refresh users",disabled:r,onClick:i,size:"sm",variant:"outline",children:e(Cn,{className:Et({"animate-spin":r})})}),e(A,{colorScheme:"primary",size:"sm",onClick:()=>l(!0),px:5,children:c("createUser")})]})})]})},Mr="https://github.com/Gozargah/Marzban",Ms="https://github.com/Gozargah",Fs="https://github.com/Gozargah/Marzban#donation",Fr=n=>{const{version:r}=E();return e(b,{w:"full",py:"0",position:"relative",...n,children:t(a,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:[e(Xt,{color:"blue.400",href:Mr,children:"Enhanced Marzban"}),r?` (v${r}), `:", ","Enhanced with \u26A1 by"," ",e(Xt,{color:"blue.400",href:"https://github.com/Kavis1/enhanced-marzban",children:"Kavis1"})," | Based on ",e(Xt,{color:"blue.400",href:Ms,children:"Gozargah Marzban"})]})})},Ws=_(so,{baseStyle:{w:4,h:4}}),Wr=({actions:n})=>{const{i18n:r}=F();var o=s=>{r.changeLanguage(s)};return t(sr,{placement:"bottom-end",children:[e(ir,{as:V,size:"sm",variant:"outline",icon:e(Ws,{}),position:"relative"}),t(ar,{minW:"100px",zIndex:9999,children:[e(Ce,{maxW:"100px",fontSize:"sm",onClick:()=>o("en"),children:"English"}),e(Ce,{maxW:"100px",fontSize:"sm",onClick:()=>o("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Ce,{maxW:"100px",fontSize:"sm",onClick:()=>o("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"}),e(Ce,{maxW:"100px",fontSize:"sm",onClick:()=>o("ru"),children:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"})]})]})},Ns=async()=>await M("/admin"),Ps=()=>{const{data:n,isError:r,isLoading:o,isSuccess:s,error:i}=Pe({queryFn:()=>Ns()});return{userData:n||{discord_webook:"",is_sudo:!1,telegram_id:"",username:""},getUserIsPending:o,getUserIsSuccess:s,getUserIsError:r,getUserError:i}},Ie={baseStyle:{w:4,h:4}},Os=_(io,Ie),js=_(ao,Ie),Pn=_(er,Ie),Hs=_(lo,Ie),Bs=_(co,Ie),$s=_(ho,Ie),Vs=_(mn,Ie),Gs=_(lr,Ie),qs=_(Gt,Ie),Ys=_(cr,Ie),On=_(v,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),Nr="marzban-menu-notification",Zs=()=>{const n=localStorage.getItem(Nr);if(!n)return!0;try{return n&&po(parseInt(n))?go(new Date,new Date(parseInt(n)))>=7:!0}catch{return!0}},Qs=({actions:n})=>{const{userData:r,getUserIsSuccess:o,getUserIsPending:s}=Ps(),i=()=>!s&&o?r.is_sudo:!1,{onEditingHosts:l,onResetAllUsage:c,onEditingNodes:g,onShowingNodesUsage:d}=E(),{t:p}=F(),{colorMode:y,toggleColorMode:S}=Oe(),[u,f]=x.exports.useState(Zs()),w=y==="dark"?"dark_dimmed":y,k=()=>{localStorage.setItem(Nr,new Date().getTime().toString()),f(!1)};return t(b,{gap:2,justifyContent:"space-between",__css:{"& .menuList":{direction:"ltr"}},position:"relative",children:[t(a,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:["Enhanced ",p("users")]}),u&&e(On,{top:"0",right:"0",zIndex:9999}),e(v,{overflow:"auto",css:{direction:"rtl"},children:t(b,{alignItems:"center",children:[t(sr,{children:[e(ir,{as:V,size:"sm",variant:"outline",icon:e(le,{children:e(Hs,{})}),position:"relative"}),t(ar,{minW:"170px",zIndex:99999,className:"menuList",children:[i()&&t(le,{children:[e(Ce,{maxW:"170px",fontSize:"sm",icon:e(Vs,{}),onClick:l.bind(null,!0),children:p("header.hostSettings")}),e(Ce,{maxW:"170px",fontSize:"sm",icon:e(Gs,{}),onClick:g.bind(null,!0),children:p("header.nodeSettings")}),e(Ce,{maxW:"170px",fontSize:"sm",icon:e(qs,{}),onClick:d.bind(null,!0),children:p("header.nodesUsage")}),e(Ce,{maxW:"170px",fontSize:"sm",icon:e(Ys,{}),onClick:c.bind(null,!0),children:p("resetAllUsage")}),e(Ce,{maxW:"170px",fontSize:"sm",icon:e(Pn,{}),onClick:()=>{E.setState({isEditingEnhanced:!0})},children:"\u{1F6E1}\uFE0F Enhanced Settings"})]}),e(Ln,{to:Fs,target:"_blank",children:t(Ce,{maxW:"170px",fontSize:"sm",icon:e($s,{}),position:"relative",onClick:k,children:[p("header.donation")," ",u&&e(On,{top:"3",right:"2"})]})}),e(Ln,{to:"/login",children:e(Ce,{maxW:"170px",fontSize:"sm",icon:e(Bs,{}),children:p("header.logout")})})]})]}),i()&&e(V,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{E.setState({isEditingCore:!0})},children:e(Pn,{})}),e(Wr,{}),e(V,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{Ur(y=="dark"?"light":"dark"),S()},children:y==="light"?e(Os,{}):e(js,{})}),e(v,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}},children:e(uo,{href:Mr,"data-color-scheme":`no-preference: ${w}; light: ${w}; dark: ${w};`,"data-size":"large","data-show-count":"true","aria-label":"Star Marzban on GitHub",children:"Star"})})]})})]})},Xs=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Js=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Ks=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(n=>({title:n,value:n}))],ei=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],ti=["aes-128-gcm","aes-256-gcm","chacha20-ietf-poly1305"],ni=$t(n=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{n({isLoading:!0}),M("/hosts").then(r=>n({hosts:r})).finally(()=>n({isLoading:!1}))},setHosts:r=>(n({isPostLoading:!0}),M("/hosts",{method:"PUT",body:r}).finally(()=>{n({isPostLoading:!1})}))}));const ri=_(rr,{baseStyle:{w:4,h:4}}),Ge=sn.forwardRef(({disabled:n,step:r,label:o,className:s,startAdornment:i,endAdornment:l,type:c="text",placeholder:g,onChange:d,onBlur:p,name:y,value:S,onClick:u,error:f,clearable:w=!1,...k},W)=>{const m=()=>{d&&d({target:{value:"",name:y}})},{size:h="md"}=k,j=c=="number"?gr:ye,B=c=="number"?dr:sn.Fragment,R=c=="number"?{keepWithinRange:!0,precision:5,format:O=>isNaN(parseFloat(String(O)))||Number(parseFloat(String(O)).toFixed(5))===0?O:Number(parseFloat(String(O)).toFixed(5)),min:0,step:r,name:y,type:c,placeholder:g,onChange:O=>{d&&d(O)},onBlur:p,value:S,onClick:u,disabled:n,flexGrow:1,size:h}:{};return t(L,{isInvalid:!!f,children:[o&&e(P,{children:o}),t(Pt,{size:h,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:n?"gray.100":"transparent",_dark:{bg:n?"gray.600":"transparent"},children:[i&&e(mo,{children:i}),t(B,{...R,children:[e(j,{name:y,ref:W,step:r,className:Et(s),type:c,placeholder:g,onChange:d,onBlur:p,value:S,onClick:u,disabled:n,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...k,roundedLeft:i?"0":"md",roundedRight:l?"0":"md"}),c=="number"&&e(le,{children:t(hr,{children:[e(ur,{}),e(pr,{})]})})]}),l&&e(fo,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:l}),w&&S&&S.length&&e(Ot,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:m,cursor:"pointer",children:e(ri,{})})]}),!!f&&e(jt,{children:f})]})}),oi=_(bo,{baseStyle:{w:5,h:5}}),si=_(yo,{baseStyle:{w:5,h:5}}),ii=_(xo,{baseStyle:{w:5,h:5}}),tn=_(qe,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),je=_(Ge,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),ai=_(mn,{baseStyle:{w:5,h:5}}),Fe=_(So,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),li=C.record(C.string().min(1),C.array(C.object({remark:C.string().min(1,"Remark is required"),address:C.string().min(1,"Address is required"),port:C.string().or(C.number()).nullable().transform(n=>typeof n=="number"?n:n!==null&&!isNaN(parseInt(n))?Number(parseInt(n)):null),path:C.string().nullable(),sni:C.string().nullable(),host:C.string().nullable(),mux_enable:C.boolean().default(!1),allowinsecure:C.boolean().nullable().default(!1),is_disabled:C.boolean().default(!0),fragment_setting:C.string().nullable(),noise_setting:C.string().nullable(),random_user_agent:C.boolean().default(!1),security:C.string(),alpn:C.string(),fingerprint:C.string(),use_sni_as_host:C.boolean().default(!1)}))),_e=_(jt,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),ci=({hostKey:n,isOpen:r,toggleAccordion:o})=>{const{inbounds:s}=E(),i=[...s.values()].flat().filter(m=>m.tag===n)[0],l=fn(),{fields:c,append:g,remove:d,insert:p,move:y}=_o({control:l.control,name:n}),{errors:S}=l.formState,{t:u}=F(),f=S[n],w=()=>{g({host:"",sni:"",port:null,path:null,address:"",remark:"",mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1})},k=m=>{if(m<0||m>=c.length)return;const h=c[m];p(m+1,h)};x.exports.useEffect(()=>{f&&!r&&o()},[f]);const W=(m,h)=>{h==="up"&&m>0?y(m,m-1):h==="down"&&m<c.length-1&&y(m,m+1)};return t(nt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(rt,{px:2,borderRadius:"3px",onClick:o,children:[e(a,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:n}),e(an,{})]}),e(ot,{px:2,pb:2,children:t(D,{gap:3,children:[c.map((m,h)=>{var j,B,R,O,q,Y,Z,se,me,U,H,X,T,K,Se,J,De,Ft,dt,Wt,ht,ut,pt,gt,mt,z,N,ee,fe,ke,Ee,G,ft,bt,yt,xt,St,et,vn,zn,In,Dn,En,Rn,Un;return e(Co.div,{layout:!0,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{layout:{type:"spring",stiffness:500,damping:30},opacity:{duration:.1}},id:m.id,whileDrag:{scale:1.05,zIndex:10},style:{width:"100%"},children:t(D,{id:m.id,border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(b,{w:"100%",alignItems:"flex-start",children:t(L,{position:"relative",zIndex:10,isInvalid:!!(f&&((j=f[h])==null?void 0:j.remark)),children:[t(Pt,{children:[e(je,{...l.register(n+"."+h+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(Ot,{children:t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(v,{mt:"-8px",children:e(Fe,{})})}),e(Ae,{children:t(Le,{children:[e(Te,{}),e(Me,{}),e(Tn,{children:t(v,{fontSize:"xs",children:[e(a,{pr:"20px",children:u("hostsDialog.desc")}),t(a,{children:[t(I,{children:["{","SERVER_IP","}"]})," ",u("hostsDialog.currentServer")]}),t(a,{mt:1,children:[t(I,{children:["{","SERVER_IPV6","}"]})," ",u("hostsDialog.currentServerv6")]}),t(a,{mt:1,children:[t(I,{children:["{","USERNAME","}"]})," ",u("hostsDialog.username")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_USAGE","}"]})," ",u("hostsDialog.dataUsage")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_LEFT","}"]})," ",u("hostsDialog.remainingData")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_LIMIT","}"]})," ",u("hostsDialog.dataLimit")]}),t(a,{mt:1,children:[t(I,{children:["{","DAYS_LEFT","}"]})," ",u("hostsDialog.remainingDays")]}),t(a,{mt:1,children:[t(I,{children:["{","EXPIRE_DATE","}"]})," ",u("hostsDialog.expireDate")]}),t(a,{mt:1,children:[t(I,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",u("hostsDialog.jalaliExpireDate")]}),t(a,{mt:1,children:[t(I,{children:["{","TIME_LEFT","}"]})," ",u("hostsDialog.remainingTime")]}),t(a,{mt:1,children:[t(I,{children:["{","STATUS_TEXT","}"]})," ",u("hostsDialog.statusText")]}),t(a,{mt:1,children:[t(I,{children:["{","STATUS_EMOJI","}"]})," ",u("hostsDialog.statusEmoji")]}),t(a,{mt:1,children:[t(I,{children:["{","PROTOCOL","}"]})," ",u("hostsDialog.proxyProtocol")]}),t(a,{mt:1,children:[t(I,{children:["{","TRANSPORT","}"]})," ",u("hostsDialog.proxyMethod")]})]})})]})})]})})]}),f&&((B=f[h])==null?void 0:B.remark)&&e(_e,{children:(O=(R=f[h])==null?void 0:R.remark)==null?void 0:O.message})]})}),t(L,{isInvalid:!!(f&&((q=f[h])==null?void 0:q.address)),children:[t(Pt,{children:[e(je,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...l.register(n+"."+h+".address")}),e(Ot,{children:t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(v,{mt:"-8px",children:e(Fe,{})})}),e(Ae,{children:t(Le,{children:[e(Te,{}),e(Me,{}),e(Tn,{children:t(v,{fontSize:"xs",children:[e(a,{pr:"20px",children:u("hostsDialog.desc")}),t(a,{children:[t(I,{children:["{","SERVER_IP","}"]})," ",u("hostsDialog.currentServer")]}),t(a,{mt:1,children:[t(I,{children:["{","SERVER_IPV6","}"]})," ",u("hostsDialog.currentServerv6")]}),t(a,{mt:1,children:[t(I,{children:["{","USERNAME","}"]})," ",u("hostsDialog.username")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_USAGE","}"]})," ",u("hostsDialog.dataUsage")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_LEFT","}"]})," ",u("hostsDialog.remainingData")]}),t(a,{mt:1,children:[t(I,{children:["{","DATA_LIMIT","}"]})," ",u("hostsDialog.dataLimit")]}),t(a,{mt:1,children:[t(I,{children:["{","DAYS_LEFT","}"]})," ",u("hostsDialog.remainingDays")]}),t(a,{mt:1,children:[t(I,{children:["{","EXPIRE_DATE","}"]})," ",u("hostsDialog.expireDate")]}),t(a,{mt:1,children:[t(I,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",u("hostsDialog.jalaliExpireDate")]}),t(a,{mt:1,children:[t(I,{children:["{","TIME_LEFT","}"]})," ",u("hostsDialog.remainingTime")]}),t(a,{mt:1,children:[t(I,{children:["{","STATUS_TEXT","}"]})," ",u("hostsDialog.statusText")]}),t(a,{mt:1,children:[t(I,{children:["{","STATUS_EMOJI","}"]})," ",u("hostsDialog.statusEmoji")]}),t(a,{mt:1,children:[t(I,{children:["{","PROTOCOL","}"]})," ",u("hostsDialog.proxyProtocol")]}),t(a,{mt:1,children:[t(I,{children:["{","TRANSPORT","}"]})," ",u("hostsDialog.proxyMethod")]})]})})]})})]})})]}),f&&((Y=f[h])==null?void 0:Y.address)&&e(_e,{children:(se=(Z=f[h])==null?void 0:Z.address)==null?void 0:se.message})]}),e(Ut,{w:"full",allowToggle:!0,children:t(nt,{border:"0",children:[t("div",{style:{display:"flex",alignItems:"center"},children:[t(rt,{display:"flex",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[t(a,{flex:"3",align:"start",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[u("hostsDialog.advancedOptions"),e(an,{fontSize:"sm",ml:1})]}),t(wo,{flex:"1",px:"0",display:"contents",children:[e(ve,{control:l.control,name:`${n}.${h}.is_disabled`,render:({field:te})=>e(Ne,{mx:"1.5",colorScheme:"primary",...te,value:void 0,isChecked:!te.value,onChange:An=>{console.log(An.target.checked),te.onChange(!An.target.checked)}})}),e(ne,{label:"Delete",placement:"top",children:e(V,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:d.bind(null,h),children:e(Tt,{})})})]})]}),e(ne,{label:"Duplicate",placement:"top",children:e(V,{"aria-label":"Duplicate",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>k(h),children:e(oi,{})})}),h<c.length-1&&e(ne,{label:"Move Down",placement:"top",children:e(V,{"aria-label":"DownIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>W(h,"down"),children:e(ii,{})})}),h>0&&e(ne,{label:"Move Up",placement:"top",children:e(V,{"aria-label":"UpIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>W(h,"up"),children:e(si,{})})})]}),e(ot,{w:"full",p:1,children:t(D,{w:"full",borderRadius:"4px",children:[t(L,{isInvalid:!!(f&&((me=f[h])==null?void 0:me.port)),children:[t(P,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:u("hostsDialog.port")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.port.info")})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:String(i.port||"8080"),type:"number",...l.register(n+"."+h+".port")})]}),t(L,{isInvalid:!!(f&&((U=f[h])==null?void 0:U.sni)),children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.sni")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.sni.info")}),e(a,{fontSize:"xs",mt:"2",children:e(Be,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(I,{})}})}),e(a,{fontSize:"xs",children:e(Be,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(I,{})}})})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...l.register(n+"."+h+".sni")}),f&&((H=f[h])==null?void 0:H.sni)&&e(_e,{children:(T=(X=f[h])==null?void 0:X.sni)==null?void 0:T.message})]}),t(L,{isInvalid:!!(f&&((K=f[h])==null?void 0:K.host)),children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.host")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.host.info")}),e(a,{fontSize:"xs",mt:"2",children:e(Be,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(I,{})}})}),e(a,{fontSize:"xs",children:e(Be,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(I,{})}})})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...l.register(n+"."+h+".host")}),f&&((Se=f[h])==null?void 0:Se.host)&&e(_e,{children:(De=(J=f[h])==null?void 0:J.host)==null?void 0:De.message})]}),t(L,{isInvalid:!!(f&&((Ft=f[h])==null?void 0:Ft.path)),children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.path")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.path.info")})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:"path (e.g. /vless)",...l.register(n+"."+h+".path")}),f&&((dt=f[h])==null?void 0:dt.path)&&e(_e,{children:(ht=(Wt=f[h])==null?void 0:Wt.path)==null?void 0:ht.message})]}),t(L,{height:"66px",children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.security")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.security.info")})]})})]})]}),e(tn,{size:"sm",...l.register(n+"."+h+".security"),children:Xs.map(te=>e("option",{value:te.value,children:te.title},te.value))})]}),t(L,{height:"66px",children:[e(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:u("hostsDialog.alpn")})}),e(tn,{size:"sm",...l.register(n+"."+h+".alpn"),children:Js.map(te=>e("option",{value:te.value,children:te.title},te.value))})]}),t(L,{height:"66px",children:[e(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:u("hostsDialog.fingerprint")})}),e(tn,{size:"sm",...l.register(n+"."+h+".fingerprint"),children:Ks.map(te=>e("option",{value:te.value,children:te.title},te.value))})]}),t(L,{isInvalid:!!(f&&((ut=f[h])==null?void 0:ut.fragment_setting)),children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.fragment")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.fragment.info")}),e(a,{fontSize:"xs",pr:5,pt:2,pb:1,children:u("hostsDialog.fragment.info.examples")}),e(a,{fontSize:"xs",pr:5,children:"100-200,10-20,tlshello"}),e(a,{fontSize:"xs",pr:5,children:"100-200,10-20,1-3"}),e(a,{fontSize:"xs",pr:5,pt:"3",children:u("hostsDialog.fragment.info.attention")})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:"Fragment settings by pattern",...l.register(n+"."+h+".fragment_setting")}),f&&((pt=f[h])==null?void 0:pt.fragment_setting)&&e(_e,{children:(mt=(gt=f[h])==null?void 0:gt.fragment_setting)==null?void 0:mt.message})]}),t(L,{isInvalid:!!(f&&((z=f[h])==null?void 0:z.noise_setting)),children:[t(P,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:u("hostsDialog.noise")}),t(Re,{isLazy:!0,placement:"right",children:[e(Ue,{children:e(Fe,{})}),e(Ae,{children:t(Le,{p:2,children:[e(Te,{}),e(Me,{}),e(a,{fontSize:"xs",pr:5,children:u("hostsDialog.noise.info")}),e(a,{fontSize:"xs",pr:5,pt:2,pb:1,children:u("hostsDialog.noise.info.examples")}),e(a,{fontSize:"xs",pr:5,children:"rand:10-20,10-20"}),e(a,{fontSize:"xs",pr:5,children:"rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25"}),e(a,{fontSize:"xs",pr:5,pt:"3",children:u("hostsDialog.noise.info.attention")})]})})]})]}),e(je,{size:"sm",borderRadius:"4px",placeholder:"Noise settings by pattern",...l.register(n+"."+h+".noise_setting")}),f&&((N=f[h])==null?void 0:N.noise_setting)&&e(_e,{children:(fe=(ee=f[h])==null?void 0:ee.noise_setting)==null?void 0:fe.message})]}),t(L,{isInvalid:!!(f&&((ke=f[h])==null?void 0:ke.use_sni_as_host)),children:[e(tt,{...l.register(n+"."+h+".use_sni_as_host"),children:e(P,{children:u("hostsDialog.useSniAsHost")})}),f&&((Ee=f[h])==null?void 0:Ee.use_sni_as_host)&&e(_e,{children:(ft=(G=f[h])==null?void 0:G.use_sni_as_host)==null?void 0:ft.message})]}),e(L,{isInvalid:!!(f&&((bt=f[h])==null?void 0:bt.allowinsecure)),children:t(tt,{...l.register(n+"."+h+".allowinsecure"),name:n+"."+h+".allowinsecure",children:[e(P,{children:u("hostsDialog.allowinsecure")}),f&&((yt=f[h])==null?void 0:yt.allowinsecure)&&e(_e,{children:(St=(xt=f[h])==null?void 0:xt.allowinsecure)==null?void 0:St.message})]})}),t(L,{isInvalid:!!(f&&((et=f[h])==null?void 0:et.mux_enable)),children:[e(tt,{...l.register(n+"."+h+".mux_enable"),children:e(P,{children:u("hostsDialog.muxEnable")})}),f&&((vn=f[h])==null?void 0:vn.mux_enable)&&e(_e,{children:(In=(zn=f[h])==null?void 0:zn.mux_enable)==null?void 0:In.message})]}),t(L,{isInvalid:!!(f&&((Dn=f[h])==null?void 0:Dn.random_user_agent)),children:[e(tt,{...l.register(n+"."+h+".random_user_agent"),children:e(P,{children:u("hostsDialog.randomUserAgent")})}),f&&((En=f[h])==null?void 0:En.random_user_agent)&&e(_e,{children:(Un=(Rn=f[h])==null?void 0:Rn.random_user_agent)==null?void 0:Un.message})]})]},h)})]})})]},m.id)},m.id)}),e(A,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:w,children:u("hostsDialog.addHost")})]})})]})},di=()=>{const{isEditingHosts:n,onEditingHosts:r,refetchUsers:o,inbounds:s}=E(),{isLoading:i,hosts:l,fetchHosts:c,isPostLoading:g,setHosts:d}=ni(),p=xe(),{t:y}=F(),[S,u]=x.exports.useState({});x.exports.useEffect(()=>{n&&c()},[n]);const f=at({resolver:Rt(li)});x.exports.useEffect(()=>{l&&n&&f.reset(l)},[l]);const w=()=>{u({}),r(!1)},k=m=>{d(m).then(()=>{p({title:y("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),o()}).catch(h=>{var j,B,R,O,q;(((j=h==null?void 0:h.response)==null?void 0:j.status)===409||((B=h==null?void 0:h.response)==null?void 0:B.status)===400)&&p({title:(O=(R=h.response)==null?void 0:R._data)==null?void 0:O.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((q=h==null?void 0:h.response)==null?void 0:q.status)===422&&Object.keys(h.response._data.detail).forEach(Y=>{p({title:h.response._data.detail[Y]+" ("+Y+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},W=m=>{S[String(m)]?delete S[String(m)]:S[String(m)]={},u({...S})};return t(ce,{isOpen:n,onClose:w,children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ue,{pt:6,children:e(we,{color:"primary",children:e(ai,{color:"white"})})}),e(pe,{mt:3}),e(ge,{w:"440px",pb:3,pt:3,children:e(mr,{...f,children:t("form",{onSubmit:f.handleSubmit(k),children:[e(a,{mb:3,opacity:.8,fontSize:"sm",children:y("hostsDialog.title")}),i&&y("hostsDialog.loading"),!i&&l&&(Object.keys(l).length>0?e(Ut,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(S).map(m=>parseInt(m)),children:e(D,{w:"full",children:Object.keys(l).map((m,h)=>e(ci,{toggleAccordion:()=>W(h),isOpen:S[String(h)],hostKey:m},m))})}):"No inbound found. Please check your Xray config file."),e(b,{justifyContent:"flex-end",py:2,children:e(A,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:g,disabled:g,children:y("hostsDialog.apply")})})]})})})]})]})},wn=(n,r,o)=>{if(n.response&&n.response._data){if(typeof n.response._data.detail=="string")return r({title:n.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof n.response._data.detail=="object"&&o){Object.keys(n.response._data.detail).forEach(s=>o.setError(s,{message:n.response._data.detail[s]}));return}}return r({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},kn=(n,r)=>r({title:n,status:"success",isClosable:!0,position:"top",duration:3e3}),hi=({deleteCallback:n})=>{const{deleteNode:r,deletingNode:o,setDeletingNode:s}=Lt(),{t:i}=F(),l=xe(),c=At(),g=()=>{s(null)},{isLoading:d,mutate:p}=Je(r,{onSuccess:()=>{kn(i("deleteNode.deleteSuccess",{name:o&&o.name}),l),s(null),c.invalidateQueries(Dt),n&&n()},onError:y=>{wn(y,l)}});return t(ce,{isCentered:!0,isOpen:!!o,onClose:g,size:"sm",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",children:[e(ue,{pt:6,children:e(we,{color:"red",children:e(Tt,{})})}),e(pe,{mt:3}),t(ge,{children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:i("deleteNode.title")}),o&&e(a,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Be,{components:{b:e("b",{})},children:i("deleteNode.prompt",{name:o.name})})})]}),t(ze,{display:"flex",children:[e(A,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(A,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:d?e(Ye,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Mt={baseStyle:{strokeWidth:"2px",w:4,h:4}},jn=_(ko,Mt),ui=_(Yt,Mt),Hn=_(vo,Mt),Bn=_(lt,Mt),pi=_(lt,Mt),pn=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Xe={active:{statusColor:"green",bandWidthColor:"primary",icon:jn},connected:{statusColor:"green",bandWidthColor:"primary",icon:jn},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:ui},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Bn},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:pi},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Bn},limited:{statusColor:"red",bandWidthColor:"red",icon:Hn},error:{statusColor:"red",bandWidthColor:"red",icon:Hn}},Qt=n=>{let r={status:"",time:""};if(n){$(n*1e3).utc().isAfter($().utc())?r.status="expires":r.status="expired";const o=[],s=$.duration($(n*1e3).utc().diff($()));s.years()!=0&&o.push(Math.abs(s.years())+" year"+(Math.abs(s.years())!=1?"s":"")),s.months()!=0&&o.push(Math.abs(s.months())+" month"+(Math.abs(s.months())!=1?"s":"")),s.days()!=0&&o.push(Math.abs(s.days())+" day"+(Math.abs(s.days())!=1?"s":"")),o.length===0&&(s.hours()!=0&&o.push(Math.abs(s.hours())+" hour"+(Math.abs(s.hours())!=1?"s":"")),s.minutes()!=0&&o.push(Math.abs(s.minutes())+" min"+(Math.abs(s.minutes())!=1?"s":""))),r.time=o.join(", ")}return r},gi=({expiryDate:n,status:r,compact:o=!1,showDetail:s=!0,extraText:i})=>{const{t:l}=F(),c=Qt(n),g=Xe[r].icon;return t(le,{children:[t(I,{colorScheme:Xe[r].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:o?1:2,alignItems:"center",children:[e(g,{w:o?3:4}),s&&t(a,{textTransform:"capitalize",fontSize:o?".7rem":".875rem",lineHeight:o?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[r&&l(`nodeModal.status.${r}`),i&&`: ${i}`]})]}),s&&n&&e(a,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l(c.status,{time:c.time})})]})},Ct=_(Ge,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),mi=_(lr,{baseStyle:{w:5,h:5}}),fi=_(zo,{baseStyle:{w:5,h:5,strokeWidth:2}}),bi=({toggleAccordion:n,node:r})=>{const{updateNode:o,reconnectNode:s,setDeletingNode:i}=Lt(),{t:l}=F(),c=At(),g=xe(),d=at({defaultValues:r,resolver:Rt(Lr)}),p=i.bind(null,r),{isLoading:y,mutate:S}=Je(o,{onSuccess:()=>{kn("Node updated successfully",g),c.invalidateQueries(Dt)},onError:k=>{wn(k,g,d)}}),{isLoading:u,mutate:f}=Je(s.bind(null,r),{onSuccess:()=>{c.invalidateQueries(Dt)}}),w=u?"connecting":r.status?r.status:"error";return t(nt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(rt,{px:2,borderRadius:"3px",onClick:n,children:[t(b,{w:"full",justifyContent:"space-between",pr:2,children:[e(a,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:r.name}),t(b,{children:[r.xray_version&&e(I,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:t(a,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",r.xray_version]})}),r.status&&e(gi,{status:w,compact:!0})]})]}),e(an,{})]}),t(ot,{px:2,pb:2,children:[e(D,{pb:3,alignItems:"flex-start",children:w==="error"&&e(Ke,{status:"error",size:"xs",children:t(v,{children:[t(b,{w:"full",children:[e(st,{w:4}),e(a,{marginInlineEnd:0,children:r.message})]}),e(b,{justifyContent:"flex-end",w:"full",children:e(A,{size:"sm","aria-label":"reconnect node",leftIcon:e(Cn,{}),onClick:()=>f(),disabled:u,children:l(u?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(Pr,{form:d,mutate:S,isLoading:y,submitBtnText:l("nodes.editNode"),btnLeftAdornment:e(ne,{label:l("delete"),placement:"top",children:e(V,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:p,children:e(Tt,{})})})})]})]})},yi=({toggleAccordion:n,resetAccordions:r})=>{const o=xe(),{t:s}=F(),i=At(),{addNode:l}=Lt(),c=at({resolver:Rt(Lr),defaultValues:{..._s(),add_as_new_host:!1}}),{isLoading:g,mutate:d}=Je(l,{onSuccess:()=>{kn(s("nodes.addNodeSuccess",{name:c.getValues("name")}),o),i.invalidateQueries(Dt),c.reset(),r()},onError:p=>{wn(p,o,c)}});return t(nt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(rt,{px:2,borderRadius:"3px",onClick:n,children:t(a,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(fi,{display:"inline-block"})," ",e("span",{children:s("nodes.addNewMarzbanNode")})]})}),e(ot,{px:2,py:4,children:e(Pr,{form:c,mutate:d,isLoading:g,submitBtnText:s("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},Pr=({form:n,mutate:r,isLoading:o,submitBtnText:s,btnProps:i={},btnLeftAdornment:l,addAsHost:c=!1})=>{var f,w,k,W,m,h,j,B,R,O,q,Y,Z,se,me;const{t:g}=F(),[d,p]=x.exports.useState(!1),{data:y,isLoading:S}=Pe({queryKey:"node-settings",queryFn:()=>M("/node/settings")});function u(U){if(document.body.createTextRange){const H=document.body.createTextRange();H.moveToElementText(U),H.select()}else if(window.getSelection){const H=window.getSelection(),X=document.createRange();X.selectNodeContents(U),H.removeAllRanges(),H.addRange(X)}else console.warn("Could not select text in node: Unsupported browser.")}return e("form",{onSubmit:n.handleSubmit(U=>r(U)),children:t(D,{children:[y&&y.certificate&&e(Ke,{status:"info",alignItems:"start",children:t(fr,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e("span",{children:g("nodes.connection-hint")}),t(b,{justify:"end",py:2,children:[e(A,{as:"a",colorScheme:"primary",size:"xs",download:"ssl_client_cert.pem",href:URL.createObjectURL(new Blob([y.certificate],{type:"text/plain"})),children:g("nodes.download-certificate")}),e(ne,{placement:"top",label:g("nodes.show-certificate"),children:e(V,{"aria-label":g("nodes.show-certificate"),onClick:p.bind(null,!d),colorScheme:"whiteAlpha",color:"primary",size:"xs",children:d?e(Io,{width:"15px"}):e(br,{width:"15px"})})})]}),e(yr,{in:d,animateOpacity:!0,children:e(a,{bg:"rgba(255,255,255,.5)",_dark:{bg:"rgba(255,255,255,.2)"},rounded:"md",p:"2",lineHeight:"1.2",fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",onClick:U=>{u(U.target)},children:y.certificate})})]})}),t(b,{w:"full",children:[e(L,{children:e(Ct,{label:g("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...n.register("name"),error:(k=(w=(f=n.formState)==null?void 0:f.errors)==null?void 0:w.name)==null?void 0:k.message})}),e(b,{px:1,children:e(ve,{name:"status",control:n.control,render:({field:U})=>e(ne,{placement:"top",label:`${g("usersTable.status")}: `+(U.value!=="disabled"?g("active"):g("disabled")),textTransform:"capitalize",children:e(v,{mt:"6",children:e(Ne,{colorScheme:"primary",isChecked:U.value!=="disabled",onChange:H=>{H.target.checked?U.onChange("connecting"):U.onChange("disabled")}})})},U.value)})})]}),e(b,{alignItems:"flex-start",w:"100%",children:e(v,{w:"100%",children:e(Ct,{label:g("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...n.register("address"),error:(h=(m=(W=n.formState)==null?void 0:W.errors)==null?void 0:m.address)==null?void 0:h.message})})}),t(b,{alignItems:"flex-start",w:"100%",children:[e(v,{children:e(Ct,{label:g("nodes.nodePort"),size:"sm",placeholder:"62050",...n.register("port"),error:(R=(B=(j=n.formState)==null?void 0:j.errors)==null?void 0:B.port)==null?void 0:R.message})}),e(v,{children:e(Ct,{label:g("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...n.register("api_port"),error:(Y=(q=(O=n.formState)==null?void 0:O.errors)==null?void 0:q.api_port)==null?void 0:Y.message})}),e(v,{children:e(Ct,{label:g("nodes.usageCoefficient"),size:"sm",placeholder:"1",...n.register("usage_coefficient"),error:(me=(se=(Z=n.formState)==null?void 0:Z.errors)==null?void 0:se.usage_coefficient)==null?void 0:me.message})})]}),c&&e(L,{py:1,children:e(tt,{...n.register("add_as_new_host"),children:e(P,{m:0,children:g("nodes.addHostForEveryInbound")})})}),t(b,{w:"full",children:[l,e(A,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:o,...i,children:s})]})]})})},xi=()=>{const{isEditingNodes:n,onEditingNodes:r}=E(),{t:o}=F(),[s,i]=x.exports.useState({}),{data:l,isLoading:c}=Tr(),g=()=>{i({}),r(!1)},d=p=>{s[String(p)]?delete s[String(p)]:s[String(p)]={},i({...s})};return t(le,{children:[t(ce,{isOpen:n,onClose:g,children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ue,{pt:6,children:e(we,{color:"primary",children:e(mi,{color:"white"})})}),e(pe,{mt:3}),t(ge,{w:"440px",pb:6,pt:3,children:[e(a,{mb:3,opacity:.8,fontSize:"sm",children:o("nodes.title")}),c&&"loading...",e(Ut,{w:"full",allowToggle:!0,index:Object.keys(s).map(p=>parseInt(p)),children:t(D,{w:"full",children:[!c&&l&&l.map((p,y)=>e(bi,{toggleAccordion:()=>d(y),node:p},p.name)),e(yi,{toggleAccordion:()=>d((l||[]).length),resetAccordions:()=>i({})})]})})]})]})]}),e(hi,{deleteCallback:()=>i({})})]})};function Si(n){const r=360/n,o=90,s=47,i=[];for(let l=0;l<n;l++){const c=l*r%360+140,g=_i(c,o,s);i.push(g)}return i}function _i(n,r,o){n/=360,r/=100,o/=100;let s,i,l;if(r===0)s=i=l=o;else{const g=(y,S,u)=>(u<0&&(u+=1),u>1&&(u-=1),u<.16666666666666666?y+(S-y)*6*u:u<.5?S:u<.6666666666666666?y+(S-y)*(.6666666666666666-u)*6:y),d=o<.5?o*(1+r):o+r-o*r,p=2*o-d;s=Math.round(g(p,d,n+1/3)*255),i=Math.round(g(p,d,n)*255),l=Math.round(g(p,d,n-1/3)*255)}const c=g=>{const d=g.toString(16);return d.length===1?"0"+d:d};return`#${c(s)}${c(i)}${c(l)}`}const $n=({border:n,...r})=>{const{getInputProps:o,getRadioProps:s}=Ro(r),i=Qe({base:"xs",md:"sm"});return t(v,{as:"label",children:[e("input",{...o()}),e(v,{...s(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:i,borderWidth:n?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:r.children})]})},Or=({onChange:n,defaultValue:r,...o})=>{const{t:s,i18n:i}=F();Oe();const l=Qe({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),c={h:"hour",d:"day",w:"week",m:"month",y:"year"},g=Qe({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:d,getRadioProps:p,setValue:y}=Do({name:"filter",defaultValue:r,onChange:U=>{if(U==="custom")return;f(),l.indexOf(U)>=0?(W(s("userDialog.custom")),h(!1)):(W(s("userDialog.custom")+` (${U})`),h(!0));const H=Number(U.substring(0,U.length-1)),X=c[U[U.length-1]];n(U,{start:$().utc().subtract(H,X).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:S,onOpen:u,onClose:f}=xr(),w=x.exports.useRef(null);Eo({ref:w,handler:f});const[k,W]=x.exports.useState(s("userDialog.custom")),[m,h]=x.exports.useState(!1),[j,B]=x.exports.useState(0),R=Qe({base:1,md:2}),O=Qe({base:"xs",md:"sm"}),[q,Y]=x.exports.useState(null),[Z,se]=x.exports.useState(null),me=U=>{const[H,X]=U;Z&&!X?(Y(null),se(null)):(Y(H),se(X),H&&X&&(f(),n("custom",{start:$(H).format("YYYY-MM-DDT00:00:00"),end:$(X).format("YYYY-MM-DDT23:59:59")})))};return t(D,{...o,children:[j==0&&t(bn,{...d(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[l.map(U=>e($n,{...p({value:U}),children:U},U)),e(v,{onClick:()=>{Y(null),se(null),u()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:O,px:3,py:1,bg:m?"primary.500":"unset",color:m?"white":"unset",borderColor:m?"primary.500":"unset",children:t(b,{children:[e(a,{children:k}),e(Jt,{as:Mn,boxSize:"18px"})]})})]}),j==1&&t(b,{onClick:u,cursor:"pointer",fontSize:O,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(a,{w:"full",color:q?"unset":"gray.500",children:q?$(q).format("YYYY-MM-DD (00:00)"):s("userDialog.startDate")}),e(Jt,{as:Sr,boxSize:"18px"}),e(a,{w:"full",color:Z?"unset":"gray.500",children:Z?$(Z).format("YYYY-MM-DD (23:59)"):s("userDialog.endDate")}),e(Jt,{as:Mn,boxSize:"18px"})]}),e(D,{ref:w,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:S?"unset":"none",children:t(yn,{onChange:U=>B(U),children:[t(xn,{children:[e($e,{fontSize:O,children:s("userDialog.relative")}),e($e,{fontSize:O,children:s("userDialog.absolute")})]}),t(Sn,{children:[e(Ve,{children:g.map(U=>e(D,{alignItems:"start",pl:2,pr:2,children:t(b,{justifyItems:"flex-start",mb:4,children:[e(a,{fontSize:O,minW:"60px",children:s("userDialog."+U.title)}),U.options.map(H=>e($n,{border:!0,...p({value:H}),children:H},H+".custom"))]})},U.title))}),e(Ve,{className:"datepicker-panel",children:e(D,{children:e(_r,{locale:i.language.toLocaleLowerCase(),selected:q,onChange:me,startDate:q,endDate:Z,selectsRange:!0,maxDate:new Date,monthsShown:R,peekNextMonth:!1,inline:!0})})})]})]})})]})};function Bt(n,r,o=[],s=[]){const i=ae(o.reduce((l,c)=>l+=c,0));return{series:o,options:{labels:s,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${r}${i}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:n==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:n==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(l,{seriesIndex:c,w:g})=>ae(g.config.series[c],1)},tooltip:{custom:({series:l,seriesIndex:c,dataPointIndex:g,w:d})=>{const p=ae(l[c],1),y=Math.max(l.reduce((u,f)=>u+=f),1),S=Math.round(l[c]/y*1e3)/10+"%";return`
            <div style="
                    background-color: ${d.globals.colors[c]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${d.config.labels[c]}: <b>${S}, ${p}</b>
            </div>
          `}},colors:Si(o.length)}}}const Ci=_(Gt,{baseStyle:{w:5,h:5}}),wi=()=>{const{isShowingNodesUsage:n,onShowingNodesUsage:r}=E(),{fetchNodesUsage:o}=Lt(),{t:s}=F(),[i,l]=x.exports.useState(!1),{colorMode:c}=Oe(),g=s("userDialog.total"),[d,p]=x.exports.useState(Bt(c,g)),[y,S]=x.exports.useState("1m"),u=k=>{o(k).then(W=>{const m=[],h=[];for(const j in W.usages){const B=W.usages[j];h.push(B.uplink+B.downlink),m.push(B.node_name)}p(Bt(c,g,h,m))})};x.exports.useEffect(()=>{n&&u({start:$().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[n]);const f=()=>{r(!1),S("1m")},w=i;return t(ce,{isOpen:n,onClose:f,size:"2xl",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",w:"full",children:[e(ue,{pt:6,children:t(b,{gap:2,children:[e(we,{color:"primary",children:e(Ci,{color:"white"})}),e(a,{fontWeight:"semibold",fontSize:"lg",children:s("header.nodesUsage")})]})}),e(pe,{mt:3,disabled:w}),e(ge,{children:t(D,{gap:4,children:[e(Or,{defaultValue:y,onChange:(k,W)=>{S(k),u(W)}}),e(v,{justifySelf:"center",w:"full",maxW:"300px",mt:"4",children:e(x.exports.Suspense,{fallback:e(nr,{isIndeterminate:!0}),children:e(Cr,{options:d.options,series:d.series,type:"donut",height:"500px"})})})]})}),e(ze,{mt:"3"})]})]})},Vn=_(Uo),ki=_(Sr,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),vi=_(Ao,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),zi=_(wr,{baseStyle:{w:5,h:5}}),Ii=()=>{const{QRcodeLinks:n,setQRCode:r,setSubLink:o,subscribeUrl:s}=E(),i=n!==null,[l,c]=x.exports.useState(0),{t:g}=F(),d=()=>{r(null),o(null)},p=String(s).startsWith("/")?window.location.origin+s:String(s);return t(ce,{isOpen:i,onClose:d,children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ue,{pt:6,children:e(we,{color:"primary",children:e(zi,{color:"white"})})}),e(pe,{mt:3}),n&&t(ge,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[s&&t(D,{children:[e(Vn,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(a,{display:"block",textAlign:"center",pb:3,mt:1,children:g("qrcodeDialog.sublink")})]}),t(v,{w:"300px",children:[e(Lo,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:c,onInit:()=>c(0),nextArrow:e(V,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(ki,{})}),prevArrow:e(V,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(vi,{})}),children:n.map((y,S)=>e(b,{children:e(Vn,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:y,bg:"white"})},S))}),t(a,{display:"block",textAlign:"center",pb:3,mt:1,children:[l+1," / ",n.length]})]})]})]})]})},Di=_(cr,{baseStyle:{w:5,h:5}}),Ei=()=>{const[n,r]=x.exports.useState(!1),{isResetingAllUsage:o,onResetAllUsage:s,resetAllUsage:i}=E(),{t:l}=F(),c=xe(),g=()=>{s(!1)},d=()=>{r(!0),i().then(()=>{c({title:l("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{c({title:l("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{r(!1)})};return t(ce,{isCentered:!0,isOpen:o,onClose:g,size:"sm",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",children:[e(ue,{pt:6,children:e(we,{color:"red",children:e(Di,{})})}),e(pe,{mt:3}),t(ge,{children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:l("resetAllUsage.title")}),o&&e(a,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:l("resetAllUsage.prompt")})]}),t(ze,{display:"flex",children:[e(A,{size:"sm",onClick:g,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(A,{size:"sm",w:"full",colorScheme:"red",onClick:d,leftIcon:n?e(Ye,{size:"xs"}):void 0,children:l("reset")})]})]})]})},Ri=_(qt,{baseStyle:{w:5,h:5}}),Ui=()=>{const[n,r]=x.exports.useState(!1),{resetUsageUser:o,resetDataUsage:s}=E(),{t:i}=F(),l=xe(),c=()=>{E.setState({resetUsageUser:null})},g=()=>{o&&(r(!0),s(o).then(()=>{l({title:i("resetUserUsage.success",{username:o.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:i("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{r(!1)}))};return t(ce,{isCentered:!0,isOpen:!!o,onClose:c,size:"sm",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",children:[e(ue,{pt:6,children:e(we,{color:"blue",children:e(Ri,{})})}),e(pe,{mt:3}),t(ge,{children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:i("resetUserUsage.title")}),o&&e(a,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Be,{components:{b:e("b",{})},children:i("resetUserUsage.prompt",{username:o.username})})})]}),t(ze,{display:"flex",children:[e(A,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(A,{size:"sm",w:"full",colorScheme:"blue",onClick:g,leftIcon:n?e(Ye,{size:"xs"}):void 0,children:i("reset")})]})]})]})},Ai=_(qt,{baseStyle:{w:5,h:5}}),Li=()=>{const[n,r]=x.exports.useState(!1),{revokeSubscriptionUser:o,revokeSubscription:s}=E(),{t:i}=F(),l=xe(),c=()=>{E.setState({revokeSubscriptionUser:null})},g=()=>{o&&(r(!0),s(o).then(()=>{l({title:i("revokeUserSub.success",{username:o.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:i("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{r(!1)}))};return t(ce,{isCentered:!0,isOpen:!!o,onClose:c,size:"sm",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(he,{mx:"3",children:[e(ue,{pt:6,children:e(we,{color:"blue",children:e(Ai,{})})}),e(pe,{mt:3}),t(ge,{children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:i("revokeUserSub.title")}),o&&e(a,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Be,{components:{b:e("b",{})},children:i("revokeUserSub.prompt",{username:o.username})})})]}),t(ze,{display:"flex",children:[e(A,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(A,{size:"sm",w:"full",colorScheme:"blue",onClick:g,leftIcon:n?e(Ye,{size:"xs"}):void 0,children:i("revoke")})]})]})]})},Ti=_(To,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),Mi=({inbound:n,...r})=>{const{getCheckboxProps:o,getInputProps:s,getLabelProps:i,htmlProps:l}=vr(r),c=s();return t(v,{as:"label",children:[e("input",{...c}),t(v,{w:"fll",position:"relative",...l,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...o(),children:[e(tt,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:c.checked,pointerEvents:"none",flexGrow:1,children:e(b,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:t(a,{isTruncated:!0,...i(),fontSize:"xs",children:[n.tag," ",t(a,{as:"span",children:["(",n.network,")"]})]})})}),n.tls&&n.tls!="none"&&e(I,{fontSize:"xs",opacity:".8",size:"xs",children:n.tls})]})]})},Fi=({disabled:n,title:r,description:o,toggleAccordion:s,isSelected:i,...l})=>{const c=fn(),{inbounds:g}=E(),{getCheckboxProps:d,getInputProps:p,getLabelProps:y,htmlProps:S}=vr(l),u=p(),[f]=zr({name:[`inbounds.${r}`],control:c.control}),{getCheckboxProps:w}=kr({value:f,onChange:h=>{if(c.setValue(`inbounds.${r}`,h),h.length===0){const j=c.getValues("selected_proxies");c.setValue("selected_proxies",j.filter(B=>B!==r)),s()}}}),k=f&&i&&(E.getState().inbounds.get(r)||[]).length!==f.length,W=(E.getState().inbounds.get(r)||[]).length>0,m=!i&&!W;return t(nt,{isDisabled:!W,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:m?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:m?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...d(),children:[t(v,{as:m?"span":"label",position:"relative",children:[k&&e(v,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{...u}),t(v,{w:"fll",position:"relative",...S,borderRadius:"md",cursor:m?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...d(),children:[e(rt,{display:u.checked&&W?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:s,children:e(V,{size:"sm","aria-label":"inbound settings",children:e(Ti,{})})}),e(a,{fontSize:"sm",color:m?"gray.400":"gray.700",_dark:{color:m?"gray.500":"gray.300"},...y(),children:r}),e(a,{fontWeight:"medium",color:m?"gray.400":"gray.600",_dark:{color:m?"gray.500":"gray.400"},fontSize:"xs",children:o})]})]}),e(ot,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:u.checked&&"gray.750"},children:t(D,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[t(D,{alignItems:"flex-start",w:"full",children:[e(a,{fontSize:"sm",children:Q("inbound")}),e(bn,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(g.get(r)||[]).map(h=>e(Mi,{...w({value:h.tag}),inbound:h},h.tag))})]}),r==="vmess"&&i&&e(D,{alignItems:"flex-start",w:"full",children:t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:"ID"}),e(ye,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Q("userDialog.generatedByDefault"),...c.register("proxies.vmess.id")})]})}),r==="vless"&&i&&t(D,{alignItems:"flex-start",w:"full",children:[t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:"ID"}),e(ye,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Q("userDialog.generatedByDefault"),...c.register("proxies.vless.id")})]}),t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:"Flow"}),e(qe,{fontSize:"xs",size:"sm",borderRadius:"6px",...c.register("proxies.vless.flow"),children:ei.map(h=>e("option",{value:h.value,children:h.title},h.title))})]})]}),r==="trojan"&&i&&e(D,{alignItems:"flex-start",w:"full",children:t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:Q("password")}),e(ye,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Q("userDialog.generatedByDefault"),...c.register("proxies.trojan.password")})]})}),r==="shadowsocks"&&i&&t(D,{alignItems:"flex-start",w:"full",children:[t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:Q("password")}),e(ye,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Q("userDialog.generatedByDefault"),...c.register("proxies.shadowsocks.password")})]}),t(L,{height:"66px",children:[e(a,{fontSize:"sm",pb:1,children:Q("userDialog.method")}),e(qe,{fontSize:"xs",size:"sm",borderRadius:"6px",...c.register("proxies.shadowsocks.method"),children:ti.map(h=>e("option",{value:h,children:h},h))})]})]})]})})]})},Wi=x.exports.forwardRef(({name:n,list:r,onChange:o,disabled:s,...i},l)=>{const c=fn(),[g,d]=x.exports.useState([]),p=S=>{g.includes(S)?g.splice(g.indexOf(S),1):g.push(S),d([...g])},{getCheckboxProps:y}=kr({value:i.value,onChange:S=>{var f;const u=S.filter(w=>!i.value.includes(w));u[0]&&c.setValue(`inbounds.${u[0]}`,(f=E.getState().inbounds.get(u[0]))==null?void 0:f.map(w=>w.tag)),d(g.filter(w=>S.find(k=>k===r[w].title))),o({target:{value:S,name:n}})}});return e(Ut,{allowToggle:!0,index:g,children:e(bn,{ref:l,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:r.map((S,u)=>e(Fi,{toggleAccordion:p.bind(null,u),disabled:s,title:S.title,description:S.description,isSelected:!!i.value.find(f=>f===S.title),...y({value:S.title})},S.title))})})}),Ni=_(Mo,{baseStyle:{w:5,h:5}}),Pi=_(Ir,{baseStyle:{w:5,h:5}}),Oi=_(Gt,{baseStyle:{w:5,h:5}}),ji=n=>({...n,data_limit:n.data_limit?Number((n.data_limit/1073741824).toFixed(5)):n.data_limit,on_hold_expire_duration:n.on_hold_expire_duration?Number(n.on_hold_expire_duration/(24*60*60)):n.on_hold_expire_duration,selected_proxies:Object.keys(n.proxies)}),nn=()=>{const n=Object.fromEntries(E.getState().inbounds),r={};for(const o in n)r[o]=n[o].map(s=>s.tag);return{selected_proxies:Object.keys(n),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:r,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}}}},Hi=(n,r)=>{const o=n.reduce((s,i)=>({...s,[i]:{}}),{});return r&&n.forEach(s=>{r[s]&&(o[s]=r[s])}),o},wt={username:C.string().min(1,{message:"Required"}),selected_proxies:C.array(C.string()).refine(n=>n.length>0,{message:"userDialog.selectOneProtocol"}),note:C.string().nullable(),proxies:C.record(C.string(),C.record(C.string(),C.any())).transform(n=>{const r=(o,s)=>{o&&o[s]===""&&delete o[s]};return r(n.vmess,"id"),r(n.vless,"id"),r(n.trojan,"password"),r(n.shadowsocks,"password"),r(n.shadowsocks,"method"),n}),data_limit:C.string().min(0).or(C.number()).nullable().transform(n=>n?Number((parseFloat(String(n))*1073741824).toFixed(5)):0),expire:C.number().nullable(),data_limit_reset_strategy:C.string(),inbounds:C.record(C.string(),C.array(C.string())).transform(n=>(Object.keys(n).forEach(r=>{var o;Array.isArray(n[r])&&!((o=n[r])!=null&&o.length)&&delete n[r]}),n))},Bi=C.discriminatedUnion("status",[C.object({status:C.literal("active"),...wt}),C.object({status:C.literal("disabled"),...wt}),C.object({status:C.literal("limited"),...wt}),C.object({status:C.literal("expired"),...wt}),C.object({status:C.literal("on_hold"),on_hold_expire_duration:C.coerce.number().min(.1,"Required").transform(n=>n*(24*60*60)),...wt})]),$i=()=>{var ht,ut,pt,gt,mt;const{editingUser:n,isCreatingNewUser:r,onCreateUser:o,editUser:s,fetchUserUsage:i,onEditingUser:l,createUser:c,onDeletingUser:g}=E(),d=!!n,p=r||d,[y,S]=x.exports.useState(!1),[u,f]=x.exports.useState(""),w=xe(),{t:k,i18n:W}=F(),{colorMode:m}=Oe(),[h,j]=x.exports.useState(!1),B=()=>{j(z=>!z)},R=at({defaultValues:nn(),resolver:Rt(Bi)});x.exports.useEffect(()=>E.subscribe(z=>z.inbounds,()=>{R.reset(nn())}),[]);const[O,q]=zr({control:R.control,name:["data_limit","status"]}),Y=k("userDialog.total"),[Z,se]=x.exports.useState(Bt(m,Y)),[me,U]=x.exports.useState("1m"),H=z=>{i(n,z).then(N=>{const ee=[],fe=[];for(const ke in N.usages)fe.push(N.usages[ke].used_traffic),ee.push(N.usages[ke].node_name);se(Bt(m,Y,fe,ee))})};x.exports.useEffect(()=>{n&&(R.reset(ji(n)),H({start:$().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[n]);const X=z=>{S(!0);const N={edited:s,created:c},ee=d?"edited":"created";f(null);const{selected_proxies:fe,...ke}=z;let Ee={...ke,data_limit:z.data_limit,proxies:Hi(fe,z.proxies),data_limit_reset_strategy:z.data_limit&&z.data_limit>0?z.data_limit_reset_strategy:"no_reset",status:z.status==="active"||z.status==="disabled"||z.status==="on_hold"?z.status:"active"};N[ee](Ee).then(()=>{w({title:k(d?"userDialog.userEdited":"userDialog.userCreated",{username:z.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),T()}).catch(G=>{var ft,bt,yt,xt,St;(((ft=G==null?void 0:G.response)==null?void 0:ft.status)===409||((bt=G==null?void 0:G.response)==null?void 0:bt.status)===400)&&f((xt=(yt=G==null?void 0:G.response)==null?void 0:yt._data)==null?void 0:xt.detail),((St=G==null?void 0:G.response)==null?void 0:St.status)===422&&Object.keys(G.response._data.detail).forEach(et=>{f(G==null?void 0:G.response._data.detail[et]),R.setError(et,{type:"custom",message:G.response._data.detail[et]})})}).finally(()=>{S(!1)})},T=()=>{R.reset(nn()),o(!1),l(null),f(null),j(!1),U("1m")},K=()=>{E.setState({resetUsageUser:n})},Se=()=>{E.setState({revokeSubscriptionUser:n})},J=y,De=q==="on_hold",[Ft,dt]=x.exports.useState(!1),Wt=()=>{dt(!0);let z="";const N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ee=N.length;let fe=0;for(;fe<6;)z+=N.charAt(Math.floor(Math.random()*ee)),fe+=1;return z};return t(ce,{isOpen:p,onClose:T,size:"2xl",children:[e(de,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(mr,{...R,children:e(he,{mx:"3",children:t("form",{onSubmit:R.handleSubmit(X),children:[e(ue,{pt:6,children:t(b,{gap:2,children:[e(we,{color:"primary",children:d?e(Pi,{color:"white"}):e(Ni,{color:"white"})}),e(a,{fontWeight:"semibold",fontSize:"lg",children:k(d?"userDialog.editUserTitle":"createNewUser")})]})}),e(pe,{mt:3,disabled:J}),t(ge,{children:[t(or,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(zt,{children:t(D,{justifyContent:"space-between",children:[t(Kt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[t(Kt,{flexDirection:"row",w:"full",gap:2,children:[t(L,{mb:"10px",children:[e(P,{children:t(Kt,{gap:2,alignItems:"center",children:[k("username"),!d&&e(Cn,{cursor:"pointer",className:Et({"animate-spin":Ft}),onClick:()=>{const z=Wt();R.setValue("username",z),setTimeout(()=>{dt(!1)},350)}})]})}),t(b,{children:[e(Ge,{size:"sm",type:"text",borderRadius:"6px",error:(ht=R.formState.errors.username)==null?void 0:ht.message,disabled:J||d,...R.register("username")}),d&&e(b,{px:1,children:e(ve,{name:"status",control:R.control,render:({field:z})=>e(ne,{placement:"top",label:"status: "+k(`status.${z.value}`),textTransform:"capitalize",children:e(v,{children:e(Ne,{colorScheme:"primary",isChecked:z.value==="active",onChange:N=>{N.target.checked?z.onChange("active"):z.onChange("disabled")}})})})})})]})]}),!d&&t(L,{flex:"1",children:[e(P,{whiteSpace:"nowrap",children:k("userDialog.onHold")}),e(ve,{name:"status",control:R.control,render:({field:z})=>{const N=z.value;return e(le,{children:N?e(Ne,{colorScheme:"primary",isChecked:N==="on_hold",onChange:ee=>{ee.target.checked?z.onChange("on_hold"):z.onChange("active")}}):""})}})]})]}),t(L,{mb:"10px",children:[e(P,{children:k("userDialog.dataLimit")}),e(ve,{control:R.control,name:"data_limit",render:({field:z})=>{var N;return e(Ge,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:z.onChange,disabled:J,error:(N=R.formState.errors.data_limit)==null?void 0:N.message,value:z.value?String(z.value):""})}})]}),e(yr,{in:!!(O&&O>0),animateOpacity:!0,style:{width:"100%"},children:t(L,{height:"66px",children:[e(P,{children:k("userDialog.periodicUsageReset")}),e(ve,{control:R.control,name:"data_limit_reset_strategy",render:({field:z})=>e(qe,{size:"sm",...z,disabled:J,bg:J?"gray.100":"transparent",_dark:{bg:J?"gray.600":"transparent"},sx:{option:{backgroundColor:m==="dark"?"#222C3B":"white"}},children:pn.map(N=>e("option",{value:N.value,children:k("userDialog.resetStrategy"+N.title)},N.value))})})]})}),t(L,{mb:"10px",children:[e(P,{children:k(De?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),De&&e(ve,{control:R.control,name:"on_hold_expire_duration",render:({field:z})=>{var N;return e(Ge,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:ee=>{R.setValue("expire",null),z.onChange({target:{value:ee}})},disabled:J,error:(N=R.formState.errors.on_hold_expire_duration)==null?void 0:N.message,value:z.value?String(z.value):""})}}),!De&&e(ve,{name:"expire",control:R.control,render:({field:z})=>{var ke;function N(Ee){return $($(Ee*1e3).utc()).toDate()}const{status:ee,time:fe}=Qt(z.value);return t(le,{children:[e(_r,{locale:W.language.toLocaleLowerCase(),dateFormat:k("dateFormat"),minDate:new Date,selected:z.value?N(z.value):void 0,onChange:Ee=>{R.setValue("on_hold_expire_duration",null),z.onChange({target:{value:Ee?$($(Ee).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(Ge,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:J,error:(ke=R.formState.errors.expire)==null?void 0:ke.message})}),z.value?e(Fo,{children:k(ee,{time:fe})}):""]})}})]}),t(L,{mb:"10px",isInvalid:!!R.formState.errors.note,children:[e(P,{children:k("userDialog.note")}),e(Dr,{...R.register("note")}),e(jt,{children:(pt=(ut=R.formState.errors)==null?void 0:ut.note)==null?void 0:pt.message})]})]}),u&&t(Ke,{status:"error",display:{base:"none",md:"flex"},children:[e(st,{}),u]})]})}),e(zt,{children:t(L,{isInvalid:!!((gt=R.formState.errors.selected_proxies)!=null&&gt.message),children:[e(P,{children:k("userDialog.protocols")}),e(ve,{control:R.control,name:"selected_proxies",render:({field:z})=>e(Wi,{list:[{title:"vmess",description:k("userDialog.vmessDesc")},{title:"vless",description:k("userDialog.vlessDesc")},{title:"trojan",description:k("userDialog.trojanDesc")},{title:"shadowsocks",description:k("userDialog.shadowsocksDesc")}],disabled:J,...z})}),e(jt,{children:k((mt=R.formState.errors.selected_proxies)==null?void 0:mt.message)})]})}),d&&h&&e(zt,{pt:6,colSpan:{base:1,md:2},children:t(D,{gap:4,children:[e(Or,{defaultValue:me,onChange:(z,N)=>{U(z),H(N)}}),e(v,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Cr,{options:Z.options,series:Z.series,type:"donut"})})]})})]}),u&&t(Ke,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(st,{}),u]})]}),e(ze,{mt:"3",children:t(b,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(b,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:d&&t(le,{children:[e(ne,{label:k("delete"),placement:"top",children:e(V,{"aria-label":"Delete",size:"sm",onClick:()=>{g(n),T()},children:e(Tt,{})})}),e(ne,{label:k("userDialog.usage"),placement:"top",children:e(V,{"aria-label":"usage",size:"sm",onClick:B,children:e(Oi,{})})}),e(A,{onClick:K,size:"sm",children:k("userDialog.resetUsage")}),e(A,{onClick:Se,size:"sm",children:k("userDialog.revokeSubscription")})]})}),e(b,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(A,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:y?e(Ye,{size:"xs"}):void 0,disabled:J,children:k(d?"userDialog.editUser":"createUser")})})]})})]})})})]})},Vi=n=>x.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...n},x.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),x.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),x.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),x.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),x.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),x.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),x.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),x.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),x.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Gi=n=>{if(!n)return null;const r=new Date(`${n}Z`);return Math.floor(r.getTime()/1e3)},Gn=({lastOnline:n})=>{const r=Math.floor(Date.now()/1e3),o=Gi(n);return!n||o===null?e(v,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):r-o<=60?e(v,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(v,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},qi=n=>{if(!n)return null;const r=new Date(n+"Z");return Math.floor(r.getTime()/1e3)},qn=({lastOnline:n})=>{const r=Math.floor(Date.now()/1e3),o=qi(n),s=o?r-o:null,i=o?Qt(o):{status:"",time:"Not Connected Yet"};return e(a,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:s&&s<=60?"Online":s?`${i.time} ago`:i.time})},Yi=_(Wo,{baseStyle:{w:4,h:4}}),Zi=_(No,{baseStyle:{w:4,h:4}}),Yn=5;function Qi(n,r,o){if(o<Yn)throw new Error(`Must allow at least ${Yn} page items`);if(o%2===0)throw new Error("Must allow odd number of page items");if(n<o)return[...new Array(n).keys()];const s=Math.max(0,Math.min(n-o,r-Math.floor(o/2))),i=new Array(o);for(let l=0;l<o;l+=1)i[l]=l+s;return i[0]>0&&(i[0]=0,i[1]="prev-more"),i[i.length-1]<n-1&&(i[i.length-1]=n-1,i[i.length-2]="next-more"),i}const Xi=()=>{const{filters:n,onFilterChange:r,users:{total:o}}=E(),{limit:s,offset:i}=n,l=(i||0)/(s||1),c=Math.ceil(o/(s||1)),g=Qi(c,l,7),d=S=>{r({...n,offset:S*s})},p=S=>{r({...n,limit:parseInt(S.target.value)}),bs(S.target.value)},{t:y}=F();return t(b,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(v,{order:{base:2,md:1},children:t(b,{children:[t(qe,{minW:"60px",value:s,onChange:p,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(a,{whiteSpace:"nowrap",fontSize:"sm",children:y("itemsPerPage")})]})}),t(Po,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(A,{leftIcon:e(Yi,{}),onClick:d.bind(null,l-1),isDisabled:l===0||c===0,children:y("previous")}),g.map(S=>typeof S=="string"?e(A,{children:"..."},S):e(A,{variant:S===l?"solid":"outline",onClick:d.bind(null,S),children:S+1},S)),e(A,{rightIcon:e(Zi,{}),onClick:d.bind(null,l+1),isDisabled:l+1===c||c===0,children:y("next")})]})]})},rn=({expiryDate:n,status:r,compact:o=!1,showDetail:s=!0,extraText:i})=>{const{t:l}=F(),c=Qt(n),g=Xe[r].icon;return t(le,{children:[t(I,{colorScheme:Xe[r].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:o?1:2,alignItems:"center",children:[e(g,{w:o?3:4}),s&&t(a,{textTransform:"capitalize",fontSize:o?".7rem":".875rem",lineHeight:o?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[r&&l(`status.${r}`),i&&`: ${i}`]})]}),s&&n&&e(a,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l(c.status,{time:c.time})})]})},Ji=({username:n,currentSettings:r,onUpdate:o})=>{var f;F();const s=xe(),i=At(),{isOpen:l,onOpen:c,onClose:g}=xr(),[d,p]=x.exports.useState({username:n,connection_limit:(r==null?void 0:r.connection_limit)||5,dns_override_enabled:(r==null?void 0:r.dns_override_enabled)||!1,custom_dns_servers:(r==null?void 0:r.custom_dns_servers)||["1.1.1.1","8.8.8.8"],adblock_enabled:(r==null?void 0:r.adblock_enabled)||!0,fail2ban_monitoring:(r==null?void 0:r.fail2ban_monitoring)||!0,traffic_analysis:(r==null?void 0:r.traffic_analysis)||!0,custom_rules:(r==null?void 0:r.custom_rules)||""}),y=Je({mutationFn:w=>M(`/api/enhanced/users/${n}/settings`,{method:"POST",body:JSON.stringify(w)}),onSuccess:()=>{s({title:"Settings Updated",description:`Enhanced settings for ${n} have been updated successfully.`,status:"success",duration:3e3,isClosable:!0}),o==null||o(d),g(),i.invalidateQueries(["user",n])},onError:()=>{s({title:"Update Failed",description:"Failed to update enhanced settings. Please try again.",status:"error",duration:3e3,isClosable:!0})}}),S=()=>{y.mutate(d)},u=()=>{p({username:n,connection_limit:5,dns_override_enabled:!1,custom_dns_servers:["1.1.1.1","8.8.8.8"],adblock_enabled:!0,fail2ban_monitoring:!0,traffic_analysis:!0,custom_rules:""})};return t(le,{children:[e(A,{size:"sm",colorScheme:"purple",variant:"outline",leftIcon:e(it,{width:"16",height:"16"}),onClick:c,children:"Enhanced Settings"}),t(ce,{isOpen:l,onClose:g,size:"xl",children:[e(de,{}),t(he,{children:[e(ue,{children:t(b,{children:[e(it,{width:"24",height:"24"}),t(a,{children:["Enhanced Settings for ",n]})]})}),e(pe,{}),e(ge,{children:t(D,{spacing:"6",align:"stretch",children:[t(Ke,{status:"info",borderRadius:"md",children:[e(st,{}),"Configure Enhanced features for this specific user. These settings override global defaults."]}),t(oe,{children:[e(We,{pb:"2",children:t(b,{children:[e(lt,{width:"20",height:"20"}),e(a,{fontWeight:"semibold",children:"Connection Limiting"})]})}),e(ie,{pt:"0",children:t(L,{children:[e(P,{fontSize:"sm",children:"Maximum Simultaneous Connections"}),t(dr,{value:d.connection_limit,onChange:(w,k)=>p({...d,connection_limit:k}),min:1,max:50,size:"sm",children:[e(gr,{}),t(hr,{children:[e(ur,{}),e(pr,{})]})]}),e(a,{fontSize:"xs",color:"gray.500",mt:"1",children:"Limit the number of simultaneous connections for this user"})]})})]}),t(oe,{children:[e(We,{pb:"2",children:t(b,{justify:"space-between",children:[t(b,{children:[e(Er,{width:"20",height:"20"}),e(a,{fontWeight:"semibold",children:"DNS Override"})]}),e(Ne,{isChecked:d.dns_override_enabled,onChange:w=>p({...d,dns_override_enabled:w.target.checked}),colorScheme:"blue"})]})}),d.dns_override_enabled&&e(ie,{pt:"0",children:t(L,{children:[e(P,{fontSize:"sm",children:"Custom DNS Servers"}),e(ye,{size:"sm",value:(f=d.custom_dns_servers)==null?void 0:f.join(", "),onChange:w=>p({...d,custom_dns_servers:w.target.value.split(",").map(k=>k.trim())}),placeholder:"1.1.1.1, 8.8.8.8, 9.9.9.9"}),e(a,{fontSize:"xs",color:"gray.500",mt:"1",children:"Comma-separated list of DNS servers for this user"})]})})]}),t(oe,{children:[e(We,{pb:"2",children:t(b,{justify:"space-between",children:[t(b,{children:[e(Yt,{width:"20",height:"20"}),e(a,{fontWeight:"semibold",children:"Ad-blocking"})]}),e(Ne,{isChecked:d.adblock_enabled,onChange:w=>p({...d,adblock_enabled:w.target.checked}),colorScheme:"green"})]})}),e(ie,{pt:"0",children:e(a,{fontSize:"sm",color:"gray.600",children:d.adblock_enabled?"Ad-blocking is enabled for this user":"Ad-blocking is disabled for this user"})})]}),t(oe,{children:[e(We,{pb:"2",children:t(b,{children:[e(Zt,{width:"20",height:"20"}),e(a,{fontWeight:"semibold",children:"Security Monitoring"})]})}),e(ie,{pt:"0",children:t(D,{spacing:"3",align:"stretch",children:[t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Fail2ban Monitoring"}),e(Ne,{isChecked:d.fail2ban_monitoring,onChange:w=>p({...d,fail2ban_monitoring:w.target.checked}),colorScheme:"red",size:"sm"})]}),t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Traffic Analysis"}),e(Ne,{isChecked:d.traffic_analysis,onChange:w=>p({...d,traffic_analysis:w.target.checked}),colorScheme:"orange",size:"sm"})]})]})})]}),t(oe,{children:[e(We,{pb:"2",children:e(a,{fontWeight:"semibold",children:"Custom Rules"})}),e(ie,{pt:"0",children:t(L,{children:[e(P,{fontSize:"sm",children:"Custom Configuration Rules"}),e(Dr,{size:"sm",value:d.custom_rules,onChange:w=>p({...d,custom_rules:w.target.value}),placeholder:"Enter custom rules or configuration for this user...",rows:4}),e(a,{fontSize:"xs",color:"gray.500",mt:"1",children:"Advanced: Custom rules in JSON format for specific user configurations"})]})})]}),t(oe,{bg:"gray.50",_dark:{bg:"gray.800"},children:[e(We,{pb:"2",children:e(a,{fontWeight:"semibold",children:"Current Enhanced Status"})}),e(ie,{pt:"0",children:t(b,{wrap:"wrap",spacing:"2",children:[t(I,{colorScheme:d.connection_limit&&d.connection_limit>0?"green":"gray",children:["Connection Limit: ",d.connection_limit||"Unlimited"]}),t(I,{colorScheme:d.dns_override_enabled?"blue":"gray",children:["DNS Override: ",d.dns_override_enabled?"Enabled":"Disabled"]}),t(I,{colorScheme:d.adblock_enabled?"green":"gray",children:["Ad-blocking: ",d.adblock_enabled?"Enabled":"Disabled"]}),t(I,{colorScheme:d.fail2ban_monitoring?"red":"gray",children:["Fail2ban: ",d.fail2ban_monitoring?"Monitoring":"Disabled"]}),t(I,{colorScheme:d.traffic_analysis?"orange":"gray",children:["Traffic Analysis: ",d.traffic_analysis?"Enabled":"Disabled"]})]})})]})]})}),e(ze,{children:t(b,{spacing:"3",children:[e(A,{variant:"outline",onClick:u,size:"sm",children:"Reset to Defaults"}),e(A,{variant:"ghost",onClick:g,size:"sm",children:"Cancel"}),e(A,{colorScheme:"blue",onClick:S,isLoading:y.isLoading,size:"sm",children:"Save Settings"})]})})]})]})]})},Ki=_(Vi),ct={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},ea=_(Oo,ct),ta=_(Rr,ct),Zn=_(jo,ct),na=_(mn,ct),ra=_(wr,ct),oa=_(Ir,ct),sa=_(Rr,{baseStyle:{width:"15px",height:"15px"}}),ia=n=>{for(var r=0;r<pn.length;r++){const o=pn[r];if(o.value==n)return o.title}return"No"},aa=n=>{const{used:r,total:o,dataLimitResetStrategy:s,totalUsedTraffic:i}=n,l=o===0||o===null;return e(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t(a,{children:[ae(r)," /"," ",l?e(a,{as:"span",fontFamily:"system-ui",children:"\u221E"}):ae(o)]})})},Qn=n=>{const{used:r,total:o,dataLimitResetStrategy:s,totalUsedTraffic:i,...l}=n,c=o===0||o===null,g=!c&&r/o*100>=100;return t(le,{children:[e(Ho,{orientation:"horizontal",value:c?100:Math.min(r/o*100,100),colorScheme:g?"red":"primary",...l,children:e(Bo,{h:"6px",borderRadius:"full",children:e($o,{borderRadius:"full"})})}),t(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[t(a,{children:[ae(r)," /"," ",c?e(a,{as:"span",fontFamily:"system-ui",children:"\u221E"}):ae(o)+(s&&s!=="no_reset"?" "+Q("userDialog.resetStrategy"+ia(s)):"")]}),t(a,{children:[Q("usersTable.total"),": ",ae(i)]})]})]})},kt=({sort:n,column:r})=>n.includes(r)?e(sa,{transform:n.startsWith("-")?void 0:"rotate(180deg)"}):null,la=n=>{const{filters:r,users:{users:o},users:s,onEditingUser:i,onFilterChange:l}=E(),{t:c}=F(),[g,d]=x.exports.useState(void 0),p=Qe({base:120,lg:72})||72,[y,S]=x.exports.useState(`${p}px`),u=Qe({base:!1,md:!0});x.exports.useEffect(()=>{const m=()=>{const h=document.querySelectorAll("#filters")[0];S(`${h.offsetHeight}px`)};window.addEventListener("scroll",m)},[]);const f=o.length!==s.total,w=m=>{let h=r.sort;h.includes(m)?h.startsWith("-")?h="-created_at":h="-"+m:h=m,l({sort:h})},k=m=>{l({status:m.target.value.length>0?m.target.value:void 0})},W=m=>{d(m===g?void 0:m)};return t(v,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Ut,{allowMultiple:!0,display:{base:"block",md:"none"},index:g,children:t(ln,{orientation:"vertical",zIndex:"docked",...n,children:[e(cn,{zIndex:"docked",position:"relative",children:t(He,{children:[e(be,{position:"sticky",top:y,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:w.bind(null,"username"),children:t(b,{children:[e("span",{children:c("users")}),e(kt,{sort:r.sort,column:"username"})]})}),e(be,{position:"sticky",top:y,minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:t(b,{spacing:0,position:"relative",children:[t(a,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),r.status?": "+r.status:""]}),t(qe,{value:r.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(le,{}),_focusVisible:{border:"0 !important"},onChange:k,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(be,{position:"sticky",top:y,minW:"100px",cursor:"pointer",pr:0,onClick:w.bind(null,"used_traffic"),children:t(b,{children:[e("span",{children:c("usersTable.dataUsage")}),e(kt,{sort:r.sort,column:"used_traffic"})]})}),e(be,{position:"sticky",top:y,minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(dn,{children:!u&&(o==null?void 0:o.map((m,h)=>t(x.exports.Fragment,{children:[t(He,{onClick:W.bind(null,h),cursor:"pointer",children:[e(re,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:t("div",{className:"flex-status",children:[e(Gn,{lastOnline:m.online_at}),e(a,{isTruncated:!0,children:m.username})]})}),e(re,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(rn,{compact:!0,showDetail:!1,expiryDate:m.expire,status:m.status})}),e(re,{borderBottom:0,minW:"100px",pr:0,children:e(aa,{totalUsedTraffic:m.lifetime_used_traffic,dataLimitResetStrategy:m.data_limit_reset_strategy,used:m.used_traffic,total:m.data_limit,colorScheme:Xe[m.status].bandWidthColor})}),e(re,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(ta,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:g===h?"rotate(180deg)":"0deg"})})]}),e(He,{className:"collapsible",onClick:W.bind(null,h),children:e(re,{p:0,colSpan:4,children:t(nt,{border:0,children:[e(rt,{display:"none"}),e(ot,{border:0,cursor:"pointer",px:6,py:3,children:t(D,{justifyContent:"space-between",spacing:"4",children:[t(D,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(a,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(v,{width:"full",minW:"230px",children:e(Qn,{totalUsedTraffic:m.lifetime_used_traffic,dataLimitResetStrategy:m.data_limit_reset_strategy,used:m.used_traffic,total:m.data_limit,colorScheme:Xe[m.status].bandWidthColor})})]}),t(b,{w:"full",justifyContent:"space-between",children:[t(v,{width:"full",children:[e(rn,{compact:!0,expiryDate:m.expire,status:m.status}),e(qn,{lastOnline:m.online_at})]}),t(b,{children:[e(Xn,{user:m}),e(ne,{label:c("userDialog.editUser"),placement:"top",children:e(V,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:j=>{j.stopPropagation(),i(m)},children:e(oa,{})})})]})]})]})})]})})})]},m.username)))})]})}),t(ln,{orientation:"vertical",display:{base:"none",md:"table"},...n,children:[e(cn,{zIndex:"docked",position:"relative",children:t(He,{children:[e(be,{position:"sticky",top:{base:"unset",md:y},minW:"140px",cursor:"pointer",onClick:w.bind(null,"username"),children:t(b,{children:[e("span",{children:c("username")}),e(kt,{sort:r.sort,column:"username"})]})}),e(be,{position:"sticky",top:{base:"unset",md:y},width:"400px",minW:"150px",cursor:"pointer",children:t(b,{position:"relative",gap:"5px",children:[t(a,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),r.status?": "+r.status:""]}),e(a,{children:"/"}),e(kt,{sort:r.sort,column:"expire"}),e(b,{onClick:w.bind(null,"expire"),children:e(a,{children:"Sort by expire"})}),t(qe,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(le,{}),_focusVisible:{border:"0 !important"},value:r.sort,onChange:k,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(be,{position:"sticky",top:{base:"unset",md:y},width:"350px",minW:"230px",cursor:"pointer",onClick:w.bind(null,"used_traffic"),children:t(b,{children:[e("span",{children:c("usersTable.dataUsage")}),e(kt,{sort:r.sort,column:"used_traffic"})]})}),e(be,{position:"sticky",top:{base:"unset",md:y},width:"200px",minW:"180px"})]})}),t(dn,{children:[u&&(o==null?void 0:o.map((m,h)=>t(He,{className:Et("interactive",{"last-row":h===o.length-1}),onClick:()=>i(m),children:[e(re,{minW:"140px",children:t("div",{className:"flex-status",children:[e(Gn,{lastOnline:m.online_at}),m.username,e(qn,{lastOnline:m.online_at})]})}),e(re,{width:"400px",minW:"150px",children:e(rn,{expiryDate:m.expire,status:m.status})}),e(re,{width:"350px",minW:"230px",children:e(Qn,{totalUsedTraffic:m.lifetime_used_traffic,dataLimitResetStrategy:m.data_limit_reset_strategy,used:m.used_traffic,total:m.data_limit,colorScheme:Xe[m.status].bandWidthColor})}),e(re,{width:"200px",minW:"180px",children:e(Xn,{user:m})})]},m.username))),o.length==0&&e(He,{children:e(re,{colSpan:4,children:e(ca,{isFiltered:f})})})]})]}),e(Xi,{})]})},Xn=({user:n})=>{const{setQRCode:r,setSubLink:o}=E(),s=n.links.join(`\r
`),[i,l]=x.exports.useState([-1,!1]);return x.exports.useEffect(()=>{i[1]&&setTimeout(()=>{l([-1,!1])},1e3)},[i]),t(b,{justifyContent:"flex-end",onClick:c=>{c.preventDefault(),c.stopPropagation()},children:[e(Fn,{text:n.subscription_url.startsWith("/")?window.location.origin+n.subscription_url:n.subscription_url,onCopy:()=>{l([0,!0])},children:e("div",{children:e(ne,{label:i[0]==0&&i[1]?Q("usersTable.copied"):Q("usersTable.copyLink"),placement:"top",children:e(V,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:i[0]==0&&i[1]?e(Zn,{}):e(na,{})})})})}),e(Fn,{text:s,onCopy:()=>{l([1,!0])},children:e("div",{children:e(ne,{label:i[0]==1&&i[1]?Q("usersTable.copied"):Q("usersTable.copyConfigs"),placement:"top",children:e(V,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:i[0]==1&&i[1]?e(Zn,{}):e(ea,{})})})})}),e(ne,{label:"QR Code",placement:"top",children:e(V,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{r(n.links),o(n.subscription_url)},children:e(ra,{})})}),e(Ji,{username:n.username})]})},ca=({isFiltered:n})=>{const{onCreateUser:r}=E();return t(v,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Ki,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(a,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n?Q("usersTable.noUserMatched"):Q("usersTable.noUser")}),!n&&e(A,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:Q("createUser")})]})},da=_(it,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),ha=_(Zt,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),ua=_(lt,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),pa=_(Vt,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Nt=({title:n,content:r,icon:o,status:s="success"})=>{const i={success:"green.400",warning:"yellow.400",error:"red.400"};return t(oe,{p:"6",bg:"white",_dark:{bg:"gray.750",borderColor:"gray.600"},borderRadius:"12px",border:"1px solid",borderColor:"light-border",position:"relative",overflow:"hidden",minH:"120px",children:[t(b,{children:[e(v,{p:"2",borderRadius:"8px",bg:i[s],color:"white",position:"relative",_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:i[s],display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:o}),e(a,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:n})]}),e(v,{fontSize:"2xl",fontWeight:"semibold",mt:"2",children:r})]})},ga="enhanced-statistics-query-key",ma=n=>{const{data:r}=Pe({queryKey:ga,queryFn:()=>M("/api/enhanced/stats"),refetchInterval:1e4,retry:!1,onError:()=>{}});F();const s=r||{blocked_threats:0,active_connections:0,fail2ban_bans:0,performance_score:95};return t(v,{...n,children:[e(a,{fontSize:"lg",fontWeight:"semibold",mb:"4",color:"blue.500",children:"\u{1F6E1}\uFE0F Enhanced Security & Performance"}),t(b,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},children:[e(Nt,{title:"Blocked Threats",content:t(b,{alignItems:"center",children:[e(a,{children:It(s.blocked_threats)}),e(I,{colorScheme:"green",size:"sm",children:"Protected"})]}),icon:e(da,{}),status:"success"}),e(Nt,{title:"Active Connections",content:It(s.active_connections),icon:e(ua,{}),status:"success"}),e(Nt,{title:"Fail2ban Bans",content:It(s.fail2ban_bans),icon:e(ha,{}),status:s.fail2ban_bans>10?"warning":"success"}),e(Nt,{title:"Performance",content:t(b,{alignItems:"center",children:[t(a,{children:[s.performance_score,"%"]}),e(I,{colorScheme:s.performance_score>90?"green":s.performance_score>70?"yellow":"red",size:"sm",children:s.performance_score>90?"Excellent":s.performance_score>70?"Good":"Poor"})]}),icon:e(pa,{}),status:s.performance_score>90?"success":s.performance_score>70?"warning":"error"})]})]})},vt=({title:n,description:r,icon:o,enabled:s,onToggle:i,children:l,status:c="success"})=>(Oe(),t(oe,{bg:"white",_dark:{bg:"gray.750",borderColor:"gray.600"},borderRadius:"12px",border:"1px solid",borderColor:"light-border",children:[e(We,{pb:"2",children:t(b,{justify:"space-between",children:[t(b,{children:[e(v,{p:"2",borderRadius:"8px",bg:s?{success:"green.400",warning:"yellow.400",error:"red.400"}[c]:"gray.400",color:"white",children:o}),t(D,{align:"start",spacing:"0",children:[e(a,{fontWeight:"semibold",fontSize:"lg",children:n}),e(a,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:r})]})]}),t(D,{align:"end",spacing:"1",children:[e(Ne,{isChecked:s,onChange:d=>i(d.target.checked),colorScheme:c==="success"?"green":c==="warning"?"yellow":"red",size:"lg"}),e(I,{colorScheme:s?c==="success"?"green":c==="warning"?"yellow":"red":"gray",size:"sm",children:s?"Active":"Disabled"})]})]})}),s&&l&&e(ie,{pt:"0",children:l})]})),fa=()=>{F();const n=xe(),r=At(),[o,s]=x.exports.useState(null),{data:i,isLoading:l}=Pe({queryKey:"enhanced-config",queryFn:()=>M("/api/enhanced/config"),onSuccess:p=>{s(p.enhanced_features)}}),c=Je({mutationFn:p=>M("/api/enhanced/config",{method:"POST",body:JSON.stringify(p)}),onSuccess:()=>{n({title:"Configuration Updated",description:"Enhanced features configuration has been updated successfully.",status:"success",duration:3e3,isClosable:!0}),r.invalidateQueries("enhanced-config")},onError:()=>{n({title:"Update Failed",description:"Failed to update configuration. Please try again.",status:"error",duration:3e3,isClosable:!0})}}),g=(p,y)=>{if(!o)return;const S={...o,[p]:{...o[p],enabled:y}};s(S),c.mutate({[p]:S[p]})},d=(p,y)=>{if(!o)return;const S={...o,[p]:{...o[p],...y}};s(S),c.mutate({[p]:S[p]})};return l||!o?e(v,{p:"6",children:e(a,{children:"Loading Enhanced Settings..."})}):t(D,{spacing:"6",p:"6",align:"stretch",children:[t(v,{children:[e(a,{fontSize:"2xl",fontWeight:"bold",mb:"2",children:"\u{1F6E1}\uFE0F Enhanced Security & Features"}),e(a,{color:"gray.600",_dark:{color:"gray.400"},children:"Configure advanced security features and monitoring capabilities"})]}),t(Ke,{status:"info",borderRadius:"md",children:[e(st,{}),"Enhanced features provide additional security, monitoring, and control capabilities. Enable only the features you need for your deployment."]}),t(yn,{variant:"enclosed",colorScheme:"blue",children:[t(xn,{children:[e($e,{children:"\u{1F510} Security"}),e($e,{children:"\u{1F4CA} Monitoring"}),e($e,{children:"\u{1F310} Network"}),e($e,{children:"\u2699\uFE0F System"})]}),t(Sn,{children:[e(Ve,{children:t(D,{spacing:"4",align:"stretch",children:[e(vt,{title:"Two-Factor Authentication",description:"Enhanced security for admin accounts with TOTP",icon:e(it,{width:"20",height:"20"}),enabled:o.two_factor_auth.enabled,onToggle:p=>g("two_factor_auth",p),status:"success",children:t(D,{spacing:"3",align:"stretch",children:[e(a,{fontSize:"sm",fontWeight:"medium",children:"2FA Configuration"}),t(b,{children:[e(A,{size:"sm",colorScheme:"blue",children:"Generate QR Code"}),e(A,{size:"sm",variant:"outline",children:"Reset Secret"})]})]})}),e(vt,{title:"Fail2ban Integration",description:"Automatic traffic monitoring and user suspension",icon:e(Zt,{width:"20",height:"20"}),enabled:o.fail2ban_integration.enabled,onToggle:p=>g("fail2ban_integration",p),status:"warning",children:t(D,{spacing:"3",align:"stretch",children:[t(b,{children:[e(a,{fontSize:"sm",fontWeight:"medium",minW:"120px",children:"Max Violations:"}),e(ye,{size:"sm",type:"number",value:o.fail2ban_integration.max_violations,onChange:p=>d("fail2ban_integration",{max_violations:parseInt(p.target.value)||3}),maxW:"100px"})]}),t(b,{children:[e(a,{fontSize:"sm",fontWeight:"medium",minW:"120px",children:"Log Path:"}),e(ye,{size:"sm",value:o.fail2ban_integration.log_path,onChange:p=>d("fail2ban_integration",{log_path:p.target.value})})]})]})})]})}),e(Ve,{children:e(D,{spacing:"4",align:"stretch",children:e(vt,{title:"Connection Limiting",description:"Limit simultaneous connections per user",icon:e(lt,{width:"20",height:"20"}),enabled:o.connection_limiting.enabled,onToggle:p=>g("connection_limiting",p),status:"success",children:t(b,{children:[e(a,{fontSize:"sm",fontWeight:"medium",minW:"150px",children:"Default Max Connections:"}),e(ye,{size:"sm",type:"number",value:o.connection_limiting.default_max_connections,onChange:p=>d("connection_limiting",{default_max_connections:parseInt(p.target.value)||5}),maxW:"100px"})]})})})}),e(Ve,{children:t(D,{spacing:"4",align:"stretch",children:[e(vt,{title:"DNS Override",description:"Custom DNS rules and domain redirection",icon:e(Er,{width:"20",height:"20"}),enabled:o.dns_override.enabled,onToggle:p=>g("dns_override",p),status:"success",children:t(D,{spacing:"3",align:"stretch",children:[e(a,{fontSize:"sm",fontWeight:"medium",children:"DNS Servers (comma-separated):"}),e(ye,{size:"sm",value:o.dns_override.dns_servers.join(", "),onChange:p=>d("dns_override",{dns_servers:p.target.value.split(",").map(y=>y.trim())}),placeholder:"1.1.1.1, 8.8.8.8"})]})}),e(vt,{title:"Ad-blocking",description:"Block advertisements and tracking domains",icon:e(Yt,{width:"20",height:"20"}),enabled:o.ad_blocking.enabled,onToggle:p=>g("ad_blocking",p),status:"success",children:t(b,{children:[e(a,{fontSize:"sm",fontWeight:"medium",minW:"120px",children:"Update Interval (hours):"}),e(ye,{size:"sm",type:"number",value:o.ad_blocking.update_interval/3600,onChange:p=>d("ad_blocking",{update_interval:(parseInt(p.target.value)||24)*3600}),maxW:"100px"})]})})]})}),e(Ve,{children:e(D,{spacing:"4",align:"stretch",children:t(oe,{children:[e(We,{children:t(b,{children:[e(Vt,{width:"20",height:"20"}),e(a,{fontWeight:"semibold",children:"System Actions"})]})}),e(ie,{children:t(D,{spacing:"3",align:"stretch",children:[t(b,{children:[e(A,{colorScheme:"blue",size:"sm",children:"Restart Enhanced Services"}),e(A,{variant:"outline",size:"sm",children:"View Service Status"})]}),t(b,{children:[e(A,{colorScheme:"green",size:"sm",children:"Initialize Services"}),e(A,{colorScheme:"red",variant:"outline",size:"sm",children:"Cleanup Services"})]})]})})]})})})]})]})]})},ba=({service:n,metrics:r})=>{Oe();const o=i=>{switch(i.toLowerCase()){case"running":case"active":return"green";case"stopped":case"inactive":return"red";case"starting":case"initializing":return"yellow";default:return"gray"}},s=i=>{switch(i){case"two_factor_auth":return e(it,{width:"20",height:"20"});case"fail2ban_logger":return e(Zt,{width:"20",height:"20"});case"connection_tracker":return e(lt,{width:"20",height:"20"});case"dns_manager":return e(br,{width:"20",height:"20"});case"adblock_manager":return e(Yt,{width:"20",height:"20"});default:return e(Vt,{width:"20",height:"20"})}};return t(oe,{bg:"white",_dark:{bg:"gray.750",borderColor:"gray.600"},borderRadius:"12px",border:"1px solid",borderColor:"light-border",children:[e(We,{pb:"2",children:t(b,{justify:"space-between",children:[t(b,{children:[e(v,{p:"2",borderRadius:"8px",bg:`${o(n.status)}.400`,color:"white",children:s(n.name)}),t(D,{align:"start",spacing:"0",children:[e(a,{fontWeight:"semibold",fontSize:"md",children:n.name.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}),t(b,{spacing:"2",children:[e(I,{colorScheme:o(n.status),size:"sm",children:n.status}),n.enabled&&e(I,{colorScheme:"blue",size:"sm",children:"Enabled"})]})]})]}),t(D,{align:"end",spacing:"1",children:[e(a,{fontSize:"xs",color:"gray.500",children:n.running?"Running":"Stopped"}),n.initialized&&e(a,{fontSize:"xs",color:"green.500",children:"Initialized"})]})]})}),r&&e(ie,{pt:"0",children:t(D,{spacing:"2",align:"stretch",children:[r.blocked_requests&&t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Blocked Requests:"}),e(a,{fontSize:"sm",fontWeight:"medium",children:r.blocked_requests})]}),r.active_connections&&t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Active Connections:"}),e(a,{fontSize:"sm",fontWeight:"medium",children:r.active_connections})]}),r.memory_usage&&t(D,{spacing:"1",align:"stretch",children:[t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Memory Usage:"}),e(a,{fontSize:"sm",fontWeight:"medium",children:ae(r.memory_usage)})]}),e(Vo,{value:r.memory_percentage||0,size:"sm",colorScheme:r.memory_percentage>80?"red":"green"})]}),r.last_activity&&t(b,{justify:"space-between",children:[e(a,{fontSize:"sm",children:"Last Activity:"}),e(a,{fontSize:"sm",color:"gray.500",children:new Date(r.last_activity).toLocaleTimeString()})]})]})}),n.error&&e(ie,{pt:"0",children:t(a,{fontSize:"sm",color:"red.500",children:["Error: ",n.error]})})]})},ya=()=>{F();const[n,r]=x.exports.useState(5e3),{data:o,isLoading:s}=Pe({queryKey:"enhanced-status",queryFn:()=>M("/api/enhanced/status"),refetchInterval:n}),{data:i,isLoading:l}=Pe({queryKey:"enhanced-metrics",queryFn:()=>M("/api/enhanced/metrics"),refetchInterval:n}),{data:c}=Pe({queryKey:"enhanced-health",queryFn:()=>M("/api/enhanced/health"),refetchInterval:n*2});if(s)return t(v,{p:"6",textAlign:"center",children:[e(Ye,{size:"lg"}),e(a,{mt:"4",children:"Loading Enhanced Services Status..."})]});const g=(o==null?void 0:o.services)||{},d=(i==null?void 0:i.services)||{};return t(D,{spacing:"6",align:"stretch",children:[t(v,{children:[t(b,{justify:"space-between",align:"center",mb:"4",children:[t(D,{align:"start",spacing:"0",children:[e(a,{fontSize:"2xl",fontWeight:"bold",children:"\u{1F4CA} Enhanced Services Monitoring"}),e(a,{color:"gray.600",_dark:{color:"gray.400"},children:"Real-time status and metrics for all Enhanced features"})]}),t(D,{align:"end",spacing:"1",children:[e(b,{children:e(A,{size:"sm",variant:"outline",onClick:()=>r(n===5e3?1e3:5e3),children:n===5e3?"Fast Refresh":"Normal Refresh"})}),t(a,{fontSize:"xs",color:"gray.500",children:["Refreshing every ",n/1e3,"s"]})]})]}),o&&e(oe,{mb:"6",bg:"blue.50",_dark:{bg:"blue.900",borderColor:"blue.700"},borderColor:"blue.200",children:e(ie,{children:t(b,{justify:"space-between",children:[t(D,{align:"start",spacing:"1",children:[e(a,{fontWeight:"semibold",children:"System Overview"}),t(b,{children:[t(I,{colorScheme:"blue",children:[o.running_services,"/",o.total_services," Services Running"]}),o.manager_initialized&&e(I,{colorScheme:"green",children:"Manager Initialized"})]})]}),t(D,{align:"end",spacing:"1",children:[t(a,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:["Last Check: ",new Date(o.last_check).toLocaleTimeString()]}),c&&e(I,{colorScheme:c.overall_health==="healthy"?"green":"red",children:c.overall_health})]})]})})})]}),t(v,{children:[e(a,{fontSize:"lg",fontWeight:"semibold",mb:"4",children:"Service Status"}),e(D,{spacing:"4",align:"stretch",children:Object.entries(g).map(([p,y])=>{var S;return e(ba,{service:y,metrics:(S=d[p])==null?void 0:S.metrics},p)})})]}),(c==null?void 0:c.issues)&&c.issues.length>0&&t(v,{children:[e(a,{fontSize:"lg",fontWeight:"semibold",mb:"4",color:"red.500",children:"\u26A0\uFE0F Health Issues"}),e(oe,{borderColor:"red.200",_dark:{borderColor:"red.700"},children:e(ie,{children:e(D,{spacing:"2",align:"stretch",children:c.issues.map((p,y)=>t(a,{fontSize:"sm",color:"red.600",_dark:{color:"red.400"},children:["\u2022 ",p]},y))})})})]}),i&&t(v,{children:[e(a,{fontSize:"lg",fontWeight:"semibold",mb:"4",children:"Recent Activity"}),e(oe,{children:e(ie,{children:t(ln,{size:"sm",children:[e(cn,{children:t(He,{children:[e(be,{children:"Service"}),e(be,{children:"Status"}),e(be,{children:"Last Activity"}),e(be,{children:"Metrics"})]})}),e(dn,{children:Object.entries(d).map(([p,y])=>{var S,u;return t(He,{children:[e(re,{children:p.replace(/_/g," ")}),e(re,{children:e(I,{colorScheme:y.status==="active"?"green":"red",children:y.status})}),e(re,{children:y.last_activity?new Date(y.last_activity).toLocaleString():"N/A"}),e(re,{children:t(a,{fontSize:"xs",children:[((S=y.metrics)==null?void 0:S.blocked_requests)&&`Blocked: ${y.metrics.blocked_requests}`,((u=y.metrics)==null?void 0:u.active_connections)&&` | Active: ${y.metrics.active_connections}`]})})]},p)})})]})})})]})]})},xa=()=>{F(),Oe();const n=E(s=>s.isEditingEnhanced),r=E(s=>s.onEditingEnhanced),o=()=>{r(!1)};return t(ce,{isOpen:n,onClose:o,size:"6xl",scrollBehavior:"inside",children:[e(de,{}),t(he,{maxH:"90vh",children:[e(ue,{children:t(b,{children:[e(it,{width:"24",height:"24"}),e(a,{children:"Enhanced Marzban Settings & Monitoring"})]})}),e(pe,{}),e(ge,{p:"0",children:t(yn,{variant:"enclosed",colorScheme:"blue",h:"full",children:[t(xn,{px:"6",pt:"4",children:[e($e,{children:"\u{1F6E1}\uFE0F Enhanced Settings"}),e($e,{children:"\u{1F4CA} Service Monitoring"})]}),t(Sn,{h:"full",children:[e(Ve,{p:"0",h:"full",children:e(fa,{})}),e(Ve,{p:"6",h:"full",children:e(ya,{})})]})]})}),e(ze,{children:e(b,{spacing:"3",children:e(A,{variant:"ghost",onClick:o,children:"Close"})})})]})]})},Sa=()=>(x.exports.useEffect(()=>{E.getState().refetchUsers(),xs()},[]),t(D,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[t(v,{w:"full",children:[e(Qs,{}),e(ms,{mt:"4"}),e(ma,{mt:"6"}),e(Ts,{}),e(la,{}),e($i,{}),e(Rs,{}),e(Ii,{}),e(di,{}),e(Ui,{}),e(Li,{}),e(xi,{}),e(wi,{}),e(Ei,{}),e(Es,{}),e(xa,{})]}),e(Fr,{})]})),_a=n=>x.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},x.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),Ca=C.object({username:C.string().min(1,"login.fieldRequired"),password:C.string().min(1,"login.fieldRequired")}),wa=_(_a,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),ka=_(Go,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Jn=()=>{var S,u;const[n,r]=x.exports.useState(""),[o,s]=x.exports.useState(!1),i=qo(),{t:l}=F();let c=Yo();const{register:g,formState:{errors:d},handleSubmit:p}=at({resolver:Rt(Ca)});x.exports.useEffect(()=>{ls(),c.pathname!=="/login"&&i("/login",{replace:!0})},[]);const y=f=>{r("");const w=new FormData;w.append("username",f.username),w.append("password",f.password),w.append("grant_type","password"),s(!0),M("/admin/token",{method:"post",body:w}).then(({access_token:k})=>{as(k),i("/")}).catch(k=>{r(k.response._data.detail)}).finally(s.bind(null,!1))};return t(D,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[t(v,{w:"full",children:[e(b,{justifyContent:"end",w:"full",children:e(Wr,{})}),e(b,{w:"full",justifyContent:"center",alignItems:"center",children:t(v,{w:"full",maxW:"340px",mt:"6",children:[t(D,{alignItems:"center",w:"full",children:[e(wa,{}),e(a,{fontSize:"2xl",fontWeight:"semibold",children:l("login.loginYourAccount")}),e(a,{color:"gray.600",_dark:{color:"gray.400"},children:l("login.welcomeBack")})]}),e(v,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:p(y),children:t(D,{mt:4,rowGap:2,children:[e(L,{children:e(Ge,{w:"full",placeholder:l("username"),...g("username"),error:l((S=d==null?void 0:d.username)==null?void 0:S.message)})}),e(L,{children:e(Ge,{w:"full",type:"password",placeholder:l("password"),...g("password"),error:l((u=d==null?void 0:d.password)==null?void 0:u.message)})}),n&&t(Ke,{status:"error",rounded:"md",children:[e(st,{}),e(fr,{children:n})]}),t(A,{isLoading:o,type:"submit",w:"full",colorScheme:"primary",children:[e(ka,{marginRight:1}),l("login")]})]})})})]})})]}),e(Fr,{})]})},va=()=>M("/admin",{headers:{Authorization:`Bearer ${Ht()}`}}),za=Zo([{path:"/",element:e(Sa,{}),errorElement:e(Jn,{}),loader:va},{path:"/login/",element:e(Jn,{})}]);function Ia(){return e("main",{className:"p-8",children:e(Qo,{router:za})})}$.extend(Xo);$.extend(Jo);$.extend(Ko);$.extend(es);$.extend(ts);Ur(ns.get()||"light");rs.createRoot(document.getElementById("root")).render(e(sn.StrictMode,{children:e(os,{theme:is,children:e(ss,{client:hn,children:e(Ia,{})})})}));
